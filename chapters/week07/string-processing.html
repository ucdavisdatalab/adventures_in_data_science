<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>23&nbsp; Strings &amp; Regular Expressions ‚Äì Adventures in Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/week07/getting-data-from-web.html" rel="next">
<link href="../../chapters/week07/data-structures.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-19b5e973626355a97465437b783fde54.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="../../site_libs/htmltools-fill-0.5.9/fill.css" rel="stylesheet">
<script src="../../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../../site_libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="../../site_libs/str_view-binding-1.6.0/str_view.js"></script>
<style>
.callout.callout-style-default .callout-body {
  padding: 0 1.5rem 0;
}
.cell-output-stdout {
  overflow-y: scroll;
  max-height: 30rem;
  margin-bottom: 0.75rem;
}
</style>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/week07/data-structures.html">Week 7</a></li><li class="breadcrumb-item"><a href="../../chapters/week07/string-processing.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Strings &amp; Regular Expressions</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://datalab.ucdavis.edu/" class="sidebar-logo-link">
      <img src="../../images/datalab-logo-full-color-rgb.png" alt="The logo of the UC Davis DataLab." class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../../images/datalab-logo-full-color-rgb.png" alt="The logo of the UC Davis DataLab." class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Adventures in Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ucdavisdatalab/adventures_in_data_science" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/required-software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Required Software</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/research-lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Research Lifecycle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/interacting-with-computers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Interacting with Computers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/browsing-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Browsing Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/other-commands.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Going Beyond Browsing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/editing-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Editing Files</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/how-ai-works.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How AI Works</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/version-control-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Version Control Systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/git-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Git Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/remote-repositories.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Remote Repositories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/the-git-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Git Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/intro-to-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduction to Datasets</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week03/intro-to-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week03/data-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Types</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/indexing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Indexing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/data-forensics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Data Forensics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/aggregation-grouping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Aggregation &amp; Grouping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week05/data-visualization-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Visualization Principles &amp; Perception</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week05/intro-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Introduction to <code>ggplot2</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week06/date-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Dates &amp; Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week06/reshaping-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week07/data-structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week07/string-processing.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Strings &amp; Regular Expressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week07/getting-data-from-web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Getting Data from the Web</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week08/writing-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week08/control-flow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Control Flow</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week09/web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 10</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Collaboration in Data-Driven Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/branches-merges.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Branches &amp; Merges</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/working-with-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Working with GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/making-git-comfortable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Making Git Comfortable</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">Special Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/11_optical-character-recognition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Optical Character Recognition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/12_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/13_reshaping-tabular-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Reshaping Tabular Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/14_network-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Network Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/15_natural-language-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Natural Language Processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/16_geospatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Geospatial Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<hr>
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"> <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" style="float: right; padding-right: 10px;"> </a></p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#string-fundamentals" id="toc-string-fundamentals" class="nav-link active" data-scroll-target="#string-fundamentals"><span class="header-section-number">23.1</span> String Fundamentals</a>
  <ul class="collapse">
  <li><a href="#escape-sequences" id="toc-escape-sequences" class="nav-link" data-scroll-target="#escape-sequences"><span class="header-section-number">23.1.1</span> Escape Sequences</a></li>
  <li><a href="#character-encodings" id="toc-character-encodings" class="nav-link" data-scroll-target="#character-encodings"><span class="header-section-number">23.1.2</span> Character Encodings</a></li>
  </ul></li>
  <li><a href="#sec-the-stringr-package" id="toc-sec-the-stringr-package" class="nav-link" data-scroll-target="#sec-the-stringr-package"><span class="header-section-number">23.2</span> The stringr Package</a></li>
  <li><a href="#sec-regular-expressions" id="toc-sec-regular-expressions" class="nav-link" data-scroll-target="#sec-regular-expressions"><span class="header-section-number">23.3</span> Regular Expressions</a></li>
  <li><a href="#replacing-parts-of-strings" id="toc-replacing-parts-of-strings" class="nav-link" data-scroll-target="#replacing-parts-of-strings"><span class="header-section-number">23.4</span> Replacing Parts of Strings</a></li>
  <li><a href="#splitting-strings" id="toc-splitting-strings" class="nav-link" data-scroll-target="#splitting-strings"><span class="header-section-number">23.5</span> Splitting Strings</a></li>
  <li><a href="#sec-extracting-matches" id="toc-sec-extracting-matches" class="nav-link" data-scroll-target="#sec-extracting-matches"><span class="header-section-number">23.6</span> Extracting Matches</a></li>
  <li><a href="#case-study-u.s.-cold-storage" id="toc-case-study-u.s.-cold-storage" class="nav-link" data-scroll-target="#case-study-u.s.-cold-storage"><span class="header-section-number">23.7</span> Case Study: U.S. Cold Storage</a></li>
  <li><a href="#sec-regular-expression-examples" id="toc-sec-regular-expression-examples" class="nav-link" data-scroll-target="#sec-regular-expression-examples"><span class="header-section-number">23.8</span> Regular Expression Examples</a>
  <ul class="collapse">
  <li><a href="#the-wildcard" id="toc-the-wildcard" class="nav-link" data-scroll-target="#the-wildcard"><span class="header-section-number">23.8.1</span> The Wildcard</a></li>
  <li><a href="#sec-escape-sequences" id="toc-sec-escape-sequences" class="nav-link" data-scroll-target="#sec-escape-sequences"><span class="header-section-number">23.8.2</span> Escape Sequences</a></li>
  <li><a href="#anchors" id="toc-anchors" class="nav-link" data-scroll-target="#anchors"><span class="header-section-number">23.8.3</span> Anchors</a></li>
  <li><a href="#character-classes" id="toc-character-classes" class="nav-link" data-scroll-target="#character-classes"><span class="header-section-number">23.8.4</span> Character Classes</a></li>
  <li><a href="#quantifiers" id="toc-quantifiers" class="nav-link" data-scroll-target="#quantifiers"><span class="header-section-number">23.8.5</span> Quantifiers</a></li>
  <li><a href="#sec-groups" id="toc-sec-groups" class="nav-link" data-scroll-target="#sec-groups"><span class="header-section-number">23.8.6</span> Groups</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/blob/main/chapters/week07/string-processing.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/week07/data-structures.html">Week 7</a></li><li class="breadcrumb-item"><a href="../../chapters/week07/string-processing.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Strings &amp; Regular Expressions</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Strings &amp; Regular Expressions</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled" title="Learning Goals">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Learning Goals
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>After this lesson, you should be able to:</p>
<ul>
<li>Use escape codes in strings to represent non-keyboard characters</li>
<li>Explain what a text encoding is</li>
<li>Use the stringr package to detect, extract, and change patterns in strings</li>
<li>Use the regular expressions mini-language</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Required Packages">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Required Packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>This chapter uses the following packages:</p>
<ul>
<li>dplyr</li>
<li>purrr</li>
<li>stringr</li>
</ul>
<p><a href="../week04/packages.html" class="quarto-xref"><span>Chapter 14</span></a> explains how to install and load packages.</p>
</div>
</div>
<p>Strings represent text, but even if your datasets are composed entirely of numbers, you‚Äôll need to know how to work with strings. Text formats for data are widespread: comma-separated values (CSV), tab-separated values (TSV), JavaScript object notation (JSON), various markup languages (HTML, XML, YAML, TOML), and more. When you read data in these formats into R, sometimes R will correctly convert the values to appropriate non-string types. The rest of the time, you need to know how to work with strings so that you can fix whatever went wrong and convert the data yourself.</p>
<p>String processing encompasses a variety of tasks such as searching for patterns within strings, extracting data from within strings, splitting strings into component parts, and removing or replacing unwanted characters (excess whitespace, punctuation, and so on).</p>
<section id="string-fundamentals" class="level2" data-number="23.1">
<h2 data-number="23.1" class="anchored" data-anchor-id="string-fundamentals"><span class="header-section-number">23.1</span> String Fundamentals</h2>
<p>This section introduces several fundamental concepts related to working with strings.</p>
<section id="escape-sequences" class="level3" data-number="23.1.1">
<h3 data-number="23.1.1" class="anchored" data-anchor-id="escape-sequences"><span class="header-section-number">23.1.1</span> Escape Sequences</h3>
<p>In a string, an <strong>escape sequence</strong> or <strong>escape code</strong> consists of a backslash followed by one or more characters. Escape sequences make it possible to:</p>
<ol type="1">
<li>Write quotes or backslashes within a string</li>
<li>Write characters that don‚Äôt appear on your keyboard (for example, characters in a foreign language)</li>
</ol>
<p>For example, the escape sequence <code>\n</code> corresponds to the newline character. Notice that the <code>message</code> function prints <code>\n</code> as a literal new line:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"Hello</span><span class="sc">\n</span><span class="st">Nick"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Hello
Nick</code></pre>
</div>
</div>
<p>On the other hand, when you let R print a string or other object automatically (without explicitly calling <code>message</code>), it prints a programmer-friendly representation. For strings, the representation shows escape codes:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Hello\nNick"</code></pre>
</div>
</div>
<p>This makes it easy to identify characters that are not normally visible, such as whitespace, and also makes it easy to copy the string. You can use the built-in <code>print</code> function to get a representation for any object.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>To print the actual characters in a string, use the <code>message</code> function.</p>
<p>To print a representation of the characters in a string, use the <code>print</code> function. The representation is useful to identify characters that are not normally visible, such as tabs and the characters that mark the end of a line.</p>
<p>There are at least two more functions in R that can print things: <code>cat</code> and <code>show</code>. The <code>cat</code> function is similar to <code>message</code>, but bypasses R‚Äôs system for keeping track of messages. The <code>show</code> function is similar to <code>print</code>, but specifically designed for R‚Äôs S4 objects, which we won‚Äôt cover. You generally shouldn‚Äôt use these two functions directly.</p>
</div>
</div>
<p>As another example, suppose we want to put literal quotation marks in a string. We can either enclose the string in the other kind of quotation marks (single versus double), or escape the quotation marks in the string:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">'She said, "Hi"'</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>She said, "Hi"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">=</span> <span class="st">"She said, </span><span class="sc">\"</span><span class="st">Hi</span><span class="sc">\"</span><span class="st">"</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>She said, "Hi"</code></pre>
</div>
</div>
<p>Since escape sequences begin with backslash, we also need to use an escape sequence to write a literal backslash. The escape sequence for a literal backslash is two backslashes:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"</span><span class="sc">\\</span><span class="st">"</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">message</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>\</code></pre>
</div>
</div>
<p>There‚Äôs a complete list of escape sequences for R in the <code>?Quotes</code> help file. Other programming languages also use escape sequences, and many of them are the same as in R.</p>
<div id="tip-raw-strings" class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip&nbsp;23.1
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>raw string</strong> is a string where escape sequences are turned off. Raw strings are especially useful for writing regular expressions (covered in <a href="#sec-regular-expressions" class="quarto-xref"><span>Section 23.3</span></a>).</p>
<p>Raw strings begin with <code>r"</code> and an opening delimiter <code>(</code>, <code>[</code>, or <code>{</code>. Raw strings end with a matching closing delimiter and quote. For example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> r<span class="st">"(quotes "</span> and backslashes \<span class="er">)</span><span class="st">"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">message(x)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>quotes " and backslashes \</code></pre>
</div>
</div>
<p>Raw strings were added to R in version 4.0 (April 2020), and won‚Äôt work correctly in older versions.</p>
</div>
</div>
</section>
<section id="character-encodings" class="level3" data-number="23.1.2">
<h3 data-number="23.1.2" class="anchored" data-anchor-id="character-encodings"><span class="header-section-number">23.1.2</span> Character Encodings</h3>
<p>Computers store data as numbers. In order to store text on a computer, people have to agree on a <strong>character encoding</strong>, a system for mapping characters to numbers. For example, in <a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a>, one of the most popular encodings in the United States, the character <code>a</code> maps to the number 97.</p>
<p>Many different character encodings exist, and sharing text used to be an inconvenient process of asking or trying to guess the correct encoding. This was so inconvenient that in the 1980s, software engineers around the world united to create the <a href="https://home.unicode.org/">Unicode</a> standard. Unicode <a href="http://unicode.org/charts/">includes symbols</a> for nearly all languages in use today, as well as emoji and many ancient languages (such as Egyptian hieroglyphs).</p>
<p>Unicode maps characters to numbers, but unlike a character encoding, it doesn‚Äôt dictate how those numbers should be mapped to bytes (sequences of ones and zeroes). As a result, there are several different character encodings that support and are synonymous with Unicode. The most popular of these is UTF-8.</p>
<p>In R, you can write Unicode characters with the escape sequence <code>\u</code> (or <code>\U</code>) followed by a 4-digit (or 8-digit) number for the character in <a href="https://en.wikipedia.org/wiki/Hexadecimal">base 16</a>. For instance, the number for <code>a</code> in Unicode is 97 (the same as in ASCII). In base 16, 97 is <code>61</code>. So you can write an <code>a</code> as:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"\u61"</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>x</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a"</code></pre>
</div>
</div>
<p>Unicode escape sequences are usually only used for characters that are not easy to type. For example, the cat emoji is number <code>1f408</code> (in base 16) in Unicode. So the string <code>"\U1f408"</code> is the cat emoji:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="st">"\U1f408"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "üêà"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Whether you can see a Unicode character depends on whether the current font has a glyph (image representation) for that character. Most fonts only have glyphs for a few languages.</p>
<p>Make sure to use a font with good Unicode coverage if you love emoji or expect to work with many different languages. The <a href="https://notofonts.github.io/">Noto Fonts</a> project aims to create a collection of fonts with a common style and complete language coverage. The <a href="https://www.nerdfonts.com/">NerdFonts</a> project patches fonts commonly used for programming so that they have better coverage of symbols.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Most of the time, R will handle character encodings for you automatically. However, if you ever read or write a text file (including CSV and other formats) and the text <a href="https://en.wikipedia.org/wiki/Mojibake">looks like gibberish</a>, it might be an encoding problem. This is especially true on Windows, the only modern operating system that does not (yet) use UTF-8 as the default encoding.</p>
<p>Encoding problems when reading a file can usually be fixed by passing the encoding to the function doing the reading. For instance, the code to read a UTF-8 encoded CSV file on Windows is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.csv</span>(<span class="st">"my_data.csv"</span>, <span class="at">fileEncoding =</span> <span class="st">"UTF-8"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Other reader functions may use a different parameter to set the encoding, so always check the documentation.</p>
<p>On computers where the native language is not set to English, it can also help to set R‚Äôs native language to English with <code>Sys.setlocale(locale = "English")</code>.</p>
<p>Encoding problems when writing a file are slightly more complicated to fix. See <a href="https://kevinushey.github.io/blog/2018/02/21/string-encoding-and-r/">this blog post</a> for thorough explanation.</p>
</div>
</div>
</section>
</section>
<section id="sec-the-stringr-package" class="level2" data-number="23.2">
<h2 data-number="23.2" class="anchored" data-anchor-id="sec-the-stringr-package"><span class="header-section-number">23.2</span> The stringr Package</h2>
<p>Although R has built-in functions for string processing, we recommend using the <a href="https://stringr.tidyverse.org/">stringr</a> package for all of your string processing needs. The package is part of the Tidyverse, a collection of packages introduced in <a href="../week04/packages.html#sec-the-tidyverse" class="quarto-xref"><span>Section 14.3</span></a>. Major advantages of stringr over other packages and R‚Äôs built-in functions include:</p>
<ul>
<li>Correctness: the package builds on <a href="https://en.wikipedia.org/wiki/International_Components_for_Unicode">International Components for Unicode (ICU)</a>, the Unicode Consortium‚Äôs own library for handling text encodings</li>
<li>Discoverability: every function‚Äôs name begins with <code>str_</code> so they‚Äôre easy to discover, remember, and identify in code</li>
<li>Interface consistency: the first argument is always the string to process, the second argument is always the pattern to match (if applicable)</li>
<li>Vectorization: most of the functions are vectorized in the first and second argument</li>
</ul>
<p>stringr has detailed <a href="https://stringr.tidyverse.org/">documentation</a> and also a <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf">cheatsheet</a>.</p>
<p>The first time you use stringr, you‚Äôll have to install it with <code>install.packages</code> (the same as any other package). Then you can load the package with the <code>library</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("stringr")</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The typical syntax of a stringr function is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_name</span>(string, pattern, ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Where:</p>
<ul>
<li><code>name</code> describes what the function does</li>
<li><code>string</code> is a string to search within or transform</li>
<li><code>pattern</code> is a pattern to search for, if applicable</li>
<li><code>...</code> is additional, function-specific arguments</li>
</ul>
<p>For example, the <code>str_detect</code> function <em>detects</em> whether a pattern appears within a string. The function returns <code>TRUE</code> if the pattern is found and <code>FALSE</code> if it isn‚Äôt:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">"hello"</span>, <span class="st">"el"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="st">"hello"</span>, <span class="st">"ol"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE</code></pre>
</div>
</div>
<p>Most of the stringr functions are vectorized in the <code>string</code> parameter:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(<span class="fu">c</span>(<span class="st">"hello"</span>, <span class="st">"goodbye"</span>, <span class="st">"lo"</span>), <span class="st">"lo"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE FALSE  TRUE</code></pre>
</div>
</div>
<p>As another example, the <code>str_sub</code> function extracts a <em>substring</em> from a string, given the substring‚Äôs position. The first argument is the string, the second is the position of the substring‚Äôs first character, and the third is the position of the substring‚Äôs last character:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(<span class="st">"You speak of destiny as if it was fixed."</span>, <span class="dv">5</span>, <span class="dv">9</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "speak"</code></pre>
</div>
</div>
<p>The <code>str_sub</code> function is especially useful for extracting data from strings that have a fixed width (although the <a href="https://readr.tidyverse.org/">readr</a> package‚Äôs <code>read_fwf</code> is usually a better choice if you have a fixed-width file).</p>
<p>There are a lot of stringr functions. Five that are especially important and are explained in this reader are:</p>
<ul>
<li><code>str_detect</code>, to test whether a string contains a pattern</li>
<li><code>str_sub</code>, to extract a substring at a given position from a string</li>
<li><code>str_replace</code>, to replace or remove parts of a string</li>
<li><code>str_split_fixed</code>, to split a string into parts</li>
<li><code>str_match</code>, to extract data from a string</li>
</ul>
<p>You can find a complete list of functions with examples on the stringr documentation‚Äôs <a href="https://stringr.tidyverse.org/reference/">reference page</a> and the <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf">cheatsheet</a>.</p>
</section>
<section id="sec-regular-expressions" class="level2" data-number="23.3">
<h2 data-number="23.3" class="anchored" data-anchor-id="sec-regular-expressions"><span class="header-section-number">23.3</span> Regular Expressions</h2>
<p>The stringr functions use a special language called <strong>regular expressions</strong> or <strong>regex</strong> to describe patterns in strings. Many other programming languages also have string processing tools that use regular expressions, so fluency with regular expressions is a valuable, transferrable skill.</p>
<p>You can use a regular expression to describe a complicated pattern in just a few characters because some characters, called <strong>metacharacters</strong>, have special meanings. Metacharacters are usually punctation characters. They are <em>never</em> letters or numbers, which always have their literal meaning.</p>
<p>This table lists some of the most useful metacharacters:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 65%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th>Metacharacter</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>.</code></td>
<td>any one character (wildcard)</td>
</tr>
<tr class="even">
<td><code>\</code></td>
<td>escape character (in both R and regex), see <a href="#sec-escape-sequences" class="quarto-xref"><span>Section 23.8.2</span></a></td>
</tr>
<tr class="odd">
<td><code>^</code></td>
<td>the beginning of string (not a character)</td>
</tr>
<tr class="even">
<td><code>$</code></td>
<td>the end of string (not a character)</td>
</tr>
<tr class="odd">
<td><code>[ab]</code></td>
<td>one character, either <code>'a'</code> or <code>'b'</code></td>
</tr>
<tr class="even">
<td><code>[^ab]</code></td>
<td>one character, anything except <code>'a'</code> or <code>'b'</code></td>
</tr>
<tr class="odd">
<td><code>?</code></td>
<td>the previous character appears 0 or 1 times</td>
</tr>
<tr class="even">
<td><code>*</code></td>
<td>the previous character appears 0 or more times</td>
</tr>
<tr class="odd">
<td><code>+</code></td>
<td>the previous character appears 1 or more times</td>
</tr>
<tr class="even">
<td><code>()</code></td>
<td>make a group</td>
</tr>
<tr class="odd">
<td><code>|</code></td>
<td>match left OR right side (not a character)</td>
</tr>
</tbody>
</table>
<p><a href="#sec-regular-expression-examples" class="quarto-xref"><span>Section 23.8</span></a> provides examples of how most of the metacharacters work.</p>
<div class="callout callout-style-default callout-note callout-titled" title="See Also">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>See Also
</div>
</div>
<div class="callout-body-container callout-body">
<p>Even more examples are presented in the stringr package‚Äôs <a href="https://stringr.tidyverse.org/articles/regular-expressions.html">regular expressions vignette</a>. You can find a complete listing of regex metacharacters in <code>?regex</code> or on the stringr <a href="https://github.com/rstudio/cheatsheets/blob/master/strings.pdf">cheatsheet</a>.</p>
</div>
</div>
<p>You can disable regular expressions in a stringr function by calling the <code>fixed</code> function on the pattern. For example, to test whether a string contains a literal dot <code>.</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"No dot"</span>, <span class="st">"Lotsa dots..."</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(x, <span class="fu">fixed</span>(<span class="st">"."</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE  TRUE</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make it a habit to call <code>fixed</code> anytime you use a pattern that doesn‚Äôt contain regex metacharacters. Doing so communicates to the reader that you‚Äôre not using regex, prevents bugs, and makes your code more efficient.</p>
</div>
</div>
</section>
<section id="replacing-parts-of-strings" class="level2" data-number="23.4">
<h2 data-number="23.4" class="anchored" data-anchor-id="replacing-parts-of-strings"><span class="header-section-number">23.4</span> Replacing Parts of Strings</h2>
<p>Replacing part of a string is a common string processing task. For instance, quantitative data often contain non-numeric characters such as commas, currency symbols, and percent signs. These must be removed before converting to numeric data types. Replacement and removal go hand-in-hand, since removal is equivalent to replacing part of a string with the <strong>empty string</strong> <code>""</code>.</p>
<p>The <code>str_replace</code> function replaces the <em>first</em> part of a string that matches a pattern (from left to right), while the related <code>str_replace_all</code> function replaces <em>every</em> part of a string that matches a pattern. Most stringr functions that do pattern matching come in a pair like this: one to process only the first match and one to process every match.</p>
<p>As an example, suppose you want to remove commas from a vector of numbers (in strings) so that you can cast them to a numeric data type with <code>as.numeric</code>. You want to remove <em>all</em> of the commas, so <code>str_replace_all</code> is the function to use. The first argument is the string and the second is the pattern. The third argument is the replacement. In this case, the pattern is <code>","</code> and the replacement is the empty string <code>""</code>. So the code to remove the commas and cast the numbers is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"1,000,000"</span>, <span class="st">"525,600"</span>, <span class="st">"42"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">str_replace_all</span>(x, <span class="fu">fixed</span>(<span class="st">","</span>), <span class="st">""</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1000000  525600      42</code></pre>
</div>
</div>
<p>The <code>str_replace</code> function wouldn‚Äôt work as well for this task, since it only replaces the first match to the pattern:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x, <span class="fu">fixed</span>(<span class="st">","</span>), <span class="st">""</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "1000,000" "525600"   "42"      </code></pre>
</div>
</div>
<p>You can also use these functions to replace or remove longer patterns within words. For instance, suppose you want to change the word <code>"dog"</code> to <code>"cat"</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"dogs are great, dogs are fun"</span>, <span class="st">"dogs are fluffy"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace</span>(x, <span class="fu">fixed</span>(<span class="st">"dog"</span>), <span class="st">"cat"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cats are great, dogs are fun" "cats are fluffy"             </code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(x, <span class="fu">fixed</span>(<span class="st">"dog"</span>), <span class="st">"cat"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "cats are great, cats are fun" "cats are fluffy"             </code></pre>
</div>
</div>
<p>As a final example, you can use the replacement functions and a regex pattern to replace repeated spaces with a single space. This is a good standardization step if you‚Äôre working with text. The key is to use the regex quantifier <code>+</code>, which means a character ‚Äúrepeats one or more times‚Äù in the pattern, and to use a single space <code>" "</code> as the replacement:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"This    sentence  has  extra      space."</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_replace_all</span>(x, <span class="st">" +"</span>, <span class="st">" "</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "This sentence has extra space."</code></pre>
</div>
</div>
<p>The <code>str_squish</code> function does this as well as removing all whitespace from the beginning and end of a string.</p>
</section>
<section id="splitting-strings" class="level2" data-number="23.5">
<h2 data-number="23.5" class="anchored" data-anchor-id="splitting-strings"><span class="header-section-number">23.5</span> Splitting Strings</h2>
<p>Distinct data in a text are generally separated by a character like a space or a comma, to make them easy for people to read. Often these separators also make the data easy for R to parse. The idea is to split the string into a separate value at each separator.</p>
<p>The <code>str_split</code> function splits a string at each match to a pattern. The matching characters‚Äîthat is, the separators‚Äîare discarded.</p>
<p>For example, suppose you want to split several numbers separated by commas and spaces:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"21, 32.3, 5, 64"</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">str_split</span>(x, <span class="st">", "</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "21"   "32.3" "5"    "64"  </code></pre>
</div>
</div>
<p>The <code>str_split</code> function always returns a list with one element for each input string. Here the list only has one element because <code>x</code> only has one element. You can get the first element with:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>result[[<span class="dv">1</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "21"   "32.3" "5"    "64"  </code></pre>
</div>
</div>
<p>You then convert the values with <code>as.numeric</code>.</p>
<p>To see why the <code>str_split</code> function always returns a list, consider what happens if you try to split two different strings at once:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(x, <span class="st">"10, 15, 1.3"</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">str_split</span>(x, <span class="st">", "</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "21"   "32.3" "5"    "64"  

[[2]]
[1] "10"  "15"  "1.3"</code></pre>
</div>
</div>
<p>Each string has a different number of parts, so the vectors in the result have different lengths. So a list is the only way to store them.</p>
<p>You can also use the <code>str_split</code> function to split a sentence into words. Use spaces for the split:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>sentences <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"The wonderful, wonderful cat!"</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Who is this duke of zill anyway?"</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>words <span class="ot">=</span> <span class="fu">str_split</span>(sentences, <span class="st">" "</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>words</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] "The"        "wonderful," "wonderful"  "cat!"      

[[2]]
[1] "Who"     "is"      "this"    "duke"    "of"      "zill"    "anyway?"</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you know exactly how many parts you expect a string to have, use the <code>str_split_fixed</code> function instead of <code>str_split</code>. It requires a third argument for the maximum number of splits. Because the number of splits is fixed, the function returns the results in a matrix rather than a list. For example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"1, 2, 3"</span>, <span class="st">"10, 20, 30"</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_split_fixed</span>(x, <span class="st">", "</span>, <span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3]
[1,] "1"  "2"  "3" 
[2,] "10" "20" "30"</code></pre>
</div>
</div>
<p>The <code>str_split_fixed</code> function is often more convenient than <code>str_split</code> because the <code>n</code>th piece of each input string is just the <code>n</code>th column of the result.</p>
<p>For example, suppose you want to get the area codes from some phone numbers:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>phones <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"717-555-3421"</span>, <span class="st">"629-555-8902"</span>, <span class="st">"903-555-6781"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">str_split_fixed</span>(phones, <span class="st">"-"</span>, <span class="dv">3</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>result[, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "717" "629" "903"</code></pre>
</div>
</div>
</div>
</div>
</section>
<section id="sec-extracting-matches" class="level2" data-number="23.6">
<h2 data-number="23.6" class="anchored" data-anchor-id="sec-extracting-matches"><span class="header-section-number">23.6</span> Extracting Matches</h2>
<p>Occasionally, you might need to extract parts of a string in a more complicated way than string splitting allows. One solution is to write a regular expression that will match all of the data you want to capture, with parentheses <code>( )</code>, the regex metacharacter for a group, around each distinct value. Then you can use the <code>str_match</code> function to extract the groups. <a href="#sec-groups" class="quarto-xref"><span>Section 23.8.6</span></a> presents some examples of regex groups.</p>
<p>For example, suppose you want to split an email address into three parts: the user name, the domain name, and the [top-level domain][tld]. To create a regular expression that matches email addresses, you can use the <code>@</code> and <code>.</code> in the address as anchors. The surrounding characters are generally alphanumeric, which you can represent with the ‚Äúword‚Äù metacharacter <code>\w</code>:</p>
<pre><code>\w+@\w+[.]\w+</code></pre>
<p>Next, put parentheses <code>( )</code> around each part that you want to extract:</p>
<pre><code>(\w+)@(\w+)[.](\w+)</code></pre>
<p>Finally, use this pattern in <code>str_match</code>, adding extra backslashes so that everything is escaped correctly:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"datalab@ucdavis.edu"</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>regex <span class="ot">=</span> <span class="st">"(</span><span class="sc">\\</span><span class="st">w+)@(</span><span class="sc">\\</span><span class="st">w+)[.](</span><span class="sc">\\</span><span class="st">w+)"</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_match</span>(x, regex)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]                  [,2]      [,3]      [,4] 
[1,] "datalab@ucdavis.edu" "datalab" "ucdavis" "edu"</code></pre>
</div>
</div>
<p>The function extracts the overall match to the pattern, as well as the match to each group.</p>
<p>The pattern in this example doesn‚Äôt work for all possible email addresses, since user names can contain dots and other characters that are not alphanumeric. You could generalize the pattern if necessary. The point is that the <code>str_match</code> function and groups provide an extremely flexible way to extract data from strings.</p>
</section>
<section id="case-study-u.s.-cold-storage" class="level2" data-number="23.7">
<h2 data-number="23.7" class="anchored" data-anchor-id="case-study-u.s.-cold-storage"><span class="header-section-number">23.7</span> Case Study: U.S. Cold Storage</h2>
<p>The U.S. Department of Agriculture (USDA) publishes a variety of datasets online, particularly through its National Agricultural Statistics Service (NASS). Unfortunately, most of are published in PDF or semi-structured text format, which makes reading the data into R or other statistical software a challenge.</p>
<p>The USDA NASS posts <a href="https://usda.library.cornell.edu/concern/publications/pg15bd892">monthly reports</a> about stocks of agricultural products in refrigerated warehouses. In this case study, you‚Äôll use string processing functions to extract a table of data from the December 2022 report.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://ucdavis.box.com/s/7jvab4ys2rfaisozq9078umx8g8vs953">Click here</a> to download the December 2022 Cold Storage report.</p>
<p>If you haven‚Äôt already, we recommend you create a directory for this workshop. In your workshop directory, create a <code>data/</code> subdirectory. Download and save the dataset in the <code>data/</code> subdirectory.</p>
</div>
</div>
<p>The goal is to extract the first table, about ‚ÄúNuts, Dairy Products, Frozen Eggs, and Frozen Poultry,‚Äù from the report.</p>
<p>The report is a semi-structured mix of natural language text and fixed-width tables. As a consequence, most functions for reading tabular data will not work well on the entire report. You could try to use a function for reading fixed-width data, such as <code>read.fwf</code> or the <a href="https://readr.tidyverse.org/">readr</a> package‚Äôs <code>read_fwf</code> on only the lines containing a table. Another approach, which is shown here, is to use string processing functions to find and extract the table.</p>
<p>The <code>readLines</code> function reads a text file into a character vector with one element for each line. This makes the function useful for reading unstructured or semi-structured text. Use the function to read the report:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>report <span class="ot">=</span> <span class="fu">readLines</span>(<span class="st">"data/2022-12_cold-storage.txt"</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(report)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] ""                                                                            
[2] "Cold Storage"                                                                
[3] ""                                                                            
[4] "ISSN: 1948-903X"                                                             
[5] ""                                                                            
[6] "Released December 22, 2022, by the National Agricultural Statistics Service "</code></pre>
</div>
</div>
<p>In the report, tables always begin and end with lines that contain only dashes <code>-</code>. By locating these all-dash lines, you can locate the tables. Like <code>str_detect</code>, the <code>str_which</code> function tests whether strings in a vector match a pattern. The only difference is that <code>str_which</code> returns the indexes of the strings that matched (as if you had called <code>which</code>) rather than a logical vector. Use <code>str_which</code> to find the all-dash lines:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The regex means:</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   ^  begining of string</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   -+ one or more dashes</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   $  end of string</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>dashes <span class="ot">=</span> <span class="fu">str_which</span>(report, <span class="st">"^-+$"</span>)</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(report[dashes], <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--------------------------------------------------------------------------------------------------------------------------"
[2] "--------------------------------------------------------------------------------------------------------------------------"</code></pre>
</div>
</div>
<p>Each table contains three dash lines‚Äîone separates the header and body. The header and body of the first table are:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>report[dashes[<span class="dv">1</span>]<span class="sc">:</span>dashes[<span class="dv">2</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--------------------------------------------------------------------------------------------------------------------------"
[2] "                                      :             :                           :     November 30, 2022     :   Public    "
[3] "                                      :        Stocks in all warehouses         :      as a percent of      :  warehouse  "
[4] "                                      :             :                           :                           :   stocks    "
[5] "               Commodity              :-----------------------------------------------------------------------------------"
[6] "                                      :November 30, : October 31, :November 30, :November 30, : October 31, :November 30, "
[7] "                                      :    2021     :    2022     :    2022     :    2021     :    2022     :    2022     "
[8] "--------------------------------------------------------------------------------------------------------------------------"</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>bod <span class="ot">=</span> report[dashes[<span class="dv">2</span>]<span class="sc">:</span>dashes[<span class="dv">3</span>]]</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bod)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "--------------------------------------------------------------------------------------------------------------------------"
[2] "                                      :  ------------ 1,000 pounds -----------        ---- percent ----      1,000 pounds "
[3] "                                      :                                                                                   "
[4] "Nuts                                  :                                                                                   "
[5] "Shelled                               :                                                                                   "
[6] "  Pecans .............................:     30,906        38,577        34,489        112            89                   "</code></pre>
</div>
</div>
<p>The columns have fixed widths, so extracting the columns is relatively easy with <code>str_sub</code> if you can get the offsets. In the last line of the header, the columns are separated by colons <code>:</code>. Thus you can use the <code>str_locate_all</code> function, which returns the locations of a pattern in a string, to get the offsets:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The regex means:</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   [^:]+  one or more characters, excluding colons</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   (:|$)  a colon or the end of the line</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">=</span> <span class="fu">str_locate_all</span>(report[dashes[<span class="dv">2</span>] <span class="sc">-</span> <span class="dv">1</span>], <span class="st">"[^:]+(:|$)"</span>)</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Like str_split, str_locate_all returns a list</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">=</span> cols[[<span class="dv">1</span>]]</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>cols</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     start end
[1,]     1  39
[2,]    40  53
[3,]    54  67
[4,]    68  81
[5,]    82  95
[6,]    96 109
[7,]   110 122</code></pre>
</div>
</div>
<p>You can use these offsets with <code>str_sub</code> to break a line in the body of the table into columns:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_sub</span>(bod[<span class="dv">6</span>], cols)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "  Pecans .............................:"
[2] "     30,906   "                         
[3] "     38,577   "                         
[4] "     34,489   "                         
[5] "     112      "                         
[6] "      89      "                         
[7] "             "                          </code></pre>
</div>
</div>
<p>In order to process every line in the body of the table in one vectorized call, we have to use <code>str_sub_all</code> rather than <code>str_sub</code>. The result is a list with one element for each line (that is, a list of rows), but we want a list of columns, so we also need to transpose the list with the purrr package‚Äôs <code>list_transpose</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"purrr"</span>)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> <span class="fu">str_sub_all</span>(bod, cols)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> <span class="fu">list_transpose</span>(tab)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The columns still contain undesirable punctuation and whitespace, but we can remove these with <code>str_replace_all</code> and <code>str_squish</code>. We can use purrr‚Äôs <code>map</code> function to call these on each column:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The regex means:</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   ,     a comma</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   |     OR</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   [.]*  zero or more literal dots</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   :     a colon</span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   $     the end of the line</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> <span class="fu">map</span>(tab, \(col) {</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  col <span class="ot">=</span> <span class="fu">str_replace_all</span>(col, <span class="st">",|[.]*:$"</span>, <span class="st">""</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>(col)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>tab[[<span class="dv">1</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "---------------------------------------"
 [2] ""                                       
 [3] ""                                       
 [4] "Nuts"                                   
 [5] "Shelled"                                
 [6] "Pecans"                                 
 [7] "In-Shell"                               
 [8] "Pecans"                                 
 [9] ""                                       
[10] "Dairy products"                         
[11] "Butter"                                 
[12] "Natural cheese"                         
[13] "American"                               
[14] "Swiss"                                  
[15] "Other"                                  
[16] "Total natural cheese"                   
[17] ""                                       
[18] "Frozen eggs"                            
[19] "Whites"                                 
[20] "Yolks"                                  
[21] "Whole and mixed"                        
[22] "Unclassified"                           
[23] "Total frozen eggs"                      
[24] ""                                       
[25] "Frozen poultry"                         
[26] "Chicken"                                
[27] "Broilers fryers and roasters"           
[28] "Hens mature chickens"                   
[29] "Breasts and breast meat"                
[30] "Drumsticks"                             
[31] "Leg quarters"                           
[32] "Legs"                                   
[33] "Thigh and thigh quarters"               
[34] "Thigh Meat"                             
[35] "Wings"                                  
[36] "Paws and feet"                          
[37] "Other"                                  
[38] "Total chicken"                          
[39] ""                                       
[40] "Turkey"                                 
[41] "Whole turkeys"                          
[42] "Toms"                                   
[43] "Hens"                                   
[44] "Total whole turkeys"                    
[45] "Breasts"                                
[46] "Legs"                                   
[47] "Mechanically deboned meat"              
[48] "Other"                                  
[49] "Unclassified"                           
[50] "Total turkey"                           
[51] ""                                       
[52] "Ducks"                                  
[53] ""                                       
[54] "Total frozen poultry"                   
[55] "---------------------------------------"</code></pre>
</div>
</div>
<p>To turn the list of columns into an actual data frame, we can use the dplyr package‚Äôs <code>bind_cols</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> <span class="fu">bind_cols</span>(tab)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tab, <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 7
   ...1                                      ...2  ...3  ...4  ...5  ...6  ...7 
   &lt;chr&gt;                                     &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
 1 "---------------------------------------" "---‚Ä¶ "---‚Ä¶ "---‚Ä¶ "---‚Ä¶ "---‚Ä¶ "---‚Ä¶
 2 ""                                        "---‚Ä¶ "100‚Ä¶ "---‚Ä¶ "---‚Ä¶ "ent‚Ä¶ "100‚Ä¶
 3 ""                                        ""    ""    ""    ""    ""    ""   
 4 "Nuts"                                    ""    ""    ""    ""    ""    ""   
 5 "Shelled"                                 ""    ""    ""    ""    ""    ""   
 6 "Pecans"                                  "309‚Ä¶ "385‚Ä¶ "344‚Ä¶ "112" "89"  ""   
 7 "In-Shell"                                ""    ""    ""    ""    ""    ""   
 8 "Pecans"                                  "637‚Ä¶ "443‚Ä¶ "476‚Ä¶ "75"  "107" ""   
 9 ""                                        ""    ""    ""    ""    ""    ""   
10 "Dairy products"                          ""    ""    ""    ""    ""    ""   </code></pre>
</div>
</div>
<p>The first few rows and the last row can be removed, since they don‚Äôt contain data. Then we can convert the individual columns to appropriate data types:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>tab <span class="ot">=</span> tab[<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="fu">nrow</span>(tab)), ]</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>tab[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>] <span class="ot">=</span> <span class="fu">map</span>(tab[<span class="dv">2</span><span class="sc">:</span><span class="dv">7</span>], as.numeric)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tab, <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 √ó 7
   ...1               ...2   ...3   ...4  ...5  ...6   ...7
   &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
 1 "Nuts"               NA     NA     NA    NA    NA     NA
 2 "Shelled"            NA     NA     NA    NA    NA     NA
 3 "Pecans"          30906  38577  34489   112    89     NA
 4 "In-Shell"           NA     NA     NA    NA    NA     NA
 5 "Pecans"          63788  44339  47638    75   107     NA
 6 ""                   NA     NA     NA    NA    NA     NA
 7 "Dairy products"     NA     NA     NA    NA    NA     NA
 8 "Butter"         210473 239658 199695    95    83 188566
 9 "Natural cheese"     NA     NA     NA    NA    NA     NA
10 "American"       834775 831213 815655    98    98     NA</code></pre>
</div>
</div>
<p>The data frame is now sufficiently clean that we could use it for a simple analysis. Of course, there are many things we could do to improve the extracted data frame, such as identifying categories and subcategories in the first column, removing rows that are completely empty, and adding column names. These entail more string processing and data frame manipulation‚Äîif you want to practice your R skills, try doing them on your own.</p>
</section>
<section id="sec-regular-expression-examples" class="level2" data-number="23.8">
<h2 data-number="23.8" class="anchored" data-anchor-id="sec-regular-expression-examples"><span class="header-section-number">23.8</span> Regular Expression Examples</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>This section is intended as a reference and is not taught in the live session.</p>
</div>
</div>
<p>This section provides examples of several different regular expression metacharacters and other features. Most of the examples use the <code>str_view</code> function, which is especially helpful for testing regular expressions. The function displays an HTML-rendered version of the string with the first match highlighted.</p>
<p>The <a href="https://regexr.com/">RegExr</a> website is also helpful for testing regular expressions; it provides an interactive interface where you can write regular expressions and see where they match a string.</p>
<section id="the-wildcard" class="level3" data-number="23.8.1">
<h3 data-number="23.8.1" class="anchored" data-anchor-id="the-wildcard"><span class="header-section-number">23.8.1</span> The Wildcard</h3>
<p>The regex <strong>wildcard</strong> character is <code>.</code> and matches any single character. For example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="st">"dog"</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"d.g"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-6616f41c680007a72cb2" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-6616f41c680007a72cb2">{"x":{"html":"<ul>\n  <li><pre><span class='match'>dog<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>By default, regex searches from left to right:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-727468f3cfb36be2a78d" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-727468f3cfb36be2a78d">{"x":{"html":"<ul>\n  <li><pre><span class='match'>d<\/span><span class='match'>o<\/span><span class='match'>g<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="sec-escape-sequences" class="level3" data-number="23.8.2">
<h3 data-number="23.8.2" class="anchored" data-anchor-id="sec-escape-sequences"><span class="header-section-number">23.8.2</span> Escape Sequences</h3>
<p>Like R, regular expressions can contain escape sequences that begin with a backslash. These are computed separately and after R escape sequences. The main use for escape sequences in regex is to turn a metacharacter into a literal character.</p>
<p>For example, suppose you want to match a literal dot <code>.</code>. The regex for a literal dot is <code>\.</code>. Since backslashes in R strings have to be escaped, the R string for this regex is <code>"\\.</code>. For example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"this.string"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-4af9ceaed0cc9d5cecb3" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-4af9ceaed0cc9d5cecb3">{"x":{"html":"<ul>\n  <li><pre>this<span class='match'>.<\/span>string<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The double backslash can be confusing, and it gets worse if you want to match a literal backslash. You have to escape the backslash in the regex (because backslash is the regex escape character) and then also have to escape the backslashes in R (because backslash is also the R escape character). So to match a single literal backslash in R, the code is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"this</span><span class="sc">\\</span><span class="st">that"</span>, <span class="st">"</span><span class="sc">\\\\</span><span class="st">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-e2f0d6f62d31dd10eff4" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-e2f0d6f62d31dd10eff4">{"x":{"html":"<ul>\n  <li><pre>this<span class='match'>\\<\/span>that<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Raw strings (see <a href="#tip-raw-strings" class="quarto-xref">Tip&nbsp;<span>23.1</span></a>) make regular expressions easier to read, because they make backslashes literal (but they still mark the beginning of an escape sequence in regex). You can use a raw string to write the above as:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(r<span class="st">"(this</span><span class="sc">\t</span><span class="st">hat)"</span>, r<span class="st">"(</span><span class="sc">\\</span><span class="st">)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-ee759315dfa5aafca730" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-ee759315dfa5aafca730">{"x":{"html":"<ul>\n  <li><pre>this<span class='match'>\\<\/span>that<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="anchors" class="level3" data-number="23.8.3">
<h3 data-number="23.8.3" class="anchored" data-anchor-id="anchors"><span class="header-section-number">23.8.3</span> Anchors</h3>
<p>By default, a regex will match anywhere in the string. If you want to force a match at specific place, use an <strong>anchor</strong>.</p>
<p>The beginning of string anchor is <code>^</code>. It marks the beginning of the string, but doesn‚Äôt count as a character in the pattern.</p>
<p>For example, suppose you want to match an <code>a</code> at the beginning of the string:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"abc"</span>, <span class="st">"cab"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"a"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-c68cbeab907dae1d9467" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-c68cbeab907dae1d9467">{"x":{"html":"<ul>\n  <li><pre><span class='match'>a<\/span>bc<\/pre><\/li>\n  <li><pre>c<span class='match'>a<\/span>b<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"^a"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-6ae66412ec9782846dd7" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-6ae66412ec9782846dd7">{"x":{"html":"<ul>\n  <li><pre><span class='match'>a<\/span>bc<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>It doesn‚Äôt make sense to put characters before <code>^</code>, since no characters can come before the beginning of the string.</p>
<p>Likewise, the end of string anchor is <code>$</code>. It marks the end of the string, but doesn‚Äôt count as a character in the pattern.</p>
</section>
<section id="character-classes" class="level3" data-number="23.8.4">
<h3 data-number="23.8.4" class="anchored" data-anchor-id="character-classes"><span class="header-section-number">23.8.4</span> Character Classes</h3>
<p>In regex, square brackets <code>[ ]</code> denote a <strong>character class</strong>. A character class matches exactly one character, but that character can be any of the characters inside of the square brackets. The square brackets themselves don‚Äôt count as characters in the pattern.</p>
<p>For example, suppose you want to match <code>c</code> followed by either <code>a</code> or <code>t</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"ca"</span>, <span class="st">"ct"</span>, <span class="st">"cat"</span>, <span class="st">"cta"</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"c[ta]"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-db33eaa097e5fe034b14" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-db33eaa097e5fe034b14">{"x":{"html":"<ul>\n  <li><pre><span class='match'>ca<\/span><\/pre><\/li>\n  <li><pre><span class='match'>ct<\/span><\/pre><\/li>\n  <li><pre><span class='match'>ca<\/span>t<\/pre><\/li>\n  <li><pre><span class='match'>ct<\/span>a<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>You can use a dash <code>-</code> in a character class to create a <strong>range</strong>. For example, to match letters <code>p</code> through <code>z</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"c[p-z]"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-4e5ffb464680ba4066c7" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-4e5ffb464680ba4066c7">{"x":{"html":"<ul>\n  <li><pre><span class='match'>ct<\/span><\/pre><\/li>\n  <li><pre><span class='match'>ct<\/span>a<\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>Ranges also work with numbers and capital letters. To match a literal dash, place the dash at the end of the character class (instead of between two other characters), as in <code>[abc-]</code>.</p>
<p>Most metacharacters are literal when inside a character class. For example, <code>[.]</code> matches a literal dot.</p>
<p>A hat <code>^</code> at the beginning of the character class negates the class. So for example, <code>[^abc]</code> matches any one character <em>except</em> for <code>a</code>, <code>b</code>, or <code>c</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"abcdef"</span>, <span class="st">"[^abc]"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-25f30bdfd92bef52d8fd" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-25f30bdfd92bef52d8fd">{"x":{"html":"<ul>\n  <li><pre>abc<span class='match'>d<\/span><span class='match'>e<\/span><span class='match'>f<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="quantifiers" class="level3" data-number="23.8.5">
<h3 data-number="23.8.5" class="anchored" data-anchor-id="quantifiers"><span class="header-section-number">23.8.5</span> Quantifiers</h3>
<p><strong>Quantifiers</strong> are metacharacters that affect how many times the preceding character must appear in a match. The quantifier itself doesn‚Äôt count as a character in the match.</p>
<p>For example, the question mark <code>?</code> quantifier means the preceding character can appear 0 or 1 times. In other words, <code>?</code> makes the preceding character optional. For example:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"abc"</span>, <span class="st">"ab"</span>, <span class="st">"ac"</span>, <span class="st">"abbc"</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"ab?c"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-b32512ee704c27ae5b68" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-b32512ee704c27ae5b68">{"x":{"html":"<ul>\n  <li><pre><span class='match'>abc<\/span><\/pre><\/li>\n  <li><pre><span class='match'>ac<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The star <code>*</code> quantifier means the preceding character can appear 0 or more times. In other words, <code>*</code> means the preceding character can appear any number of times or not at all. For instance:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"ab*c"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-c10ca20d30b5e7b48d5c" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-c10ca20d30b5e7b48d5c">{"x":{"html":"<ul>\n  <li><pre><span class='match'>abc<\/span><\/pre><\/li>\n  <li><pre><span class='match'>ac<\/span><\/pre><\/li>\n  <li><pre><span class='match'>abbc<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The plus <code>+</code> quantifier means the preceding character must appear 1 or more times.</p>
<p>Quantifiers are <strong>greedy</strong>, meaning they always match as many characters as possible. In this example, notice that the pattern matches the entire string, even though it could also match just <code>abba</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"abbabbba"</span>, <span class="st">".+a"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-fc328ff8309aa150e15d" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-fc328ff8309aa150e15d">{"x":{"html":"<ul>\n  <li><pre><span class='match'>abbabbba<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>You can add a question mark <code>?</code> after another quantifier to make it non-greedy:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(<span class="st">"abbabbba"</span>, <span class="st">".+?a"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-6c9696c2ccd1ed72c667" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-6c9696c2ccd1ed72c667">{"x":{"html":"<ul>\n  <li><pre><span class='match'>abba<\/span><span class='match'>bbba<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="sec-groups" class="level3" data-number="23.8.6">
<h3 data-number="23.8.6" class="anchored" data-anchor-id="sec-groups"><span class="header-section-number">23.8.6</span> Groups</h3>
<p>In regex, parentheses <code>( )</code> denote a <strong>group</strong>. The parentheses themselves don‚Äôt count as characters in the pattern. Groups are useful for repeating or extracting specific parts of a pattern (see <a href="#sec-extracting-matches" class="quarto-xref"><span>Section 23.6</span></a>).</p>
<p>Quantifiers can act on groups in addition to individual characters. For example, suppose you want to make the entire substring <code>", dogs,"</code> optional in a pattern, so that both of the test strings in this example match:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"cats, dogs, and frogs"</span>, <span class="st">"cats and frogs"</span>)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_view</span>(x, <span class="st">"cats(, dogs,)? and frogs"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div class="str_view html-widget html-fill-item" id="htmlwidget-7668f1c7f5622d268909" style="width:960px;height:100%;"></div>
<script type="application/json" data-for="htmlwidget-7668f1c7f5622d268909">{"x":{"html":"<ul>\n  <li><pre><span class='match'>cats, dogs, and frogs<\/span><\/pre><\/li>\n  <li><pre><span class='match'>cats and frogs<\/span><\/pre><\/li>\n<\/ul>"},"evals":[],"jsHooks":[]}</script>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "Óßã";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/week07/data-structures.html" class="pagination-link" aria-label="Data Structures">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Structures</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/week07/getting-data-from-web.html" class="pagination-link" aria-label="Getting Data from the Web">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Getting Data from the Web</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/blob/main/chapters/week07/string-processing.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div></div></footer></body></html>