<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>26&nbsp; Control Flow – Adventures in Data Science</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/week09/web-scraping.html" rel="next">
<link href="../../chapters/week08/writing-functions.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-19b5e973626355a97465437b783fde54.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<style>
.callout.callout-style-default .callout-body {
  padding: 0 1.5rem 0;
}
.cell-output-stdout {
  overflow-y: scroll;
  max-height: 30rem;
  margin-bottom: 0.75rem;
}
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/week08/writing-functions.html">Week 8</a></li><li class="breadcrumb-item"><a href="../../chapters/week08/control-flow.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Control Flow</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="https://datalab.ucdavis.edu/" class="sidebar-logo-link">
      <img src="../../images/datalab-logo-full-color-rgb.png" alt="The logo of the UC Davis DataLab." class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../../images/datalab-logo-full-color-rgb.png" alt="The logo of the UC Davis DataLab." class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Adventures in Data Science</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ucdavisdatalab/adventures_in_data_science" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/required-software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Required Software</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/research-lifecycle.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Research Lifecycle</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/interacting-with-computers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Interacting with Computers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/browsing-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Browsing Files</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/other-commands.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Going Beyond Browsing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week01/editing-files.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Editing Files</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/how-ai-works.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">How AI Works</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/version-control-systems.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Version Control Systems</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/git-basics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Git Basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/remote-repositories.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Remote Repositories</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/the-git-workflow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">The Git Workflow</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week02/intro-to-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Introduction to Datasets</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week03/intro-to-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Introduction to R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week03/data-types.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Types</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 4</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/packages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Packages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/indexing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Indexing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/data-forensics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Data Forensics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week04/aggregation-grouping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Aggregation &amp; Grouping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 5</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week05/data-visualization-principles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Data Visualization Principles &amp; Perception</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week05/intro-ggplot2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Introduction to <code>ggplot2</code></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 6</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week06/date-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Dates &amp; Times</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week06/reshaping-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Reshaping Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 7</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week07/data-structures.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Data Structures</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week07/string-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Strings &amp; Regular Expressions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week07/getting-data-from-web.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Getting Data from the Web</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 8</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week08/writing-functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Writing Functions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week08/control-flow.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Control Flow</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 9</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week09/web-scraping.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Web Scraping</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 10</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/collaboration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Collaboration in Data-Driven Work</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/branches-merges.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Branches &amp; Merges</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/working-with-github.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Working with GitHub</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/week10/making-git-comfortable.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Making Git Comfortable</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true">
 <span class="menu-text">Special Topics</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/11_optical-character-recognition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Optical Character Recognition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/12_statistics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Statistics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/13_reshaping-tabular-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Reshaping Tabular Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/14_network-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Network Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/15_natural-language-processing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Natural Language Processing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/16_geospatial-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Geospatial Data</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
<div class="quarto-sidebar-footer"><div class="sidebar-footer-item">
<hr>
<p><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank"> <img alt="CC BY-SA 4.0" src="https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg" style="float: right; padding-right: 10px;"> </a></p>
</div></div></nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#conditional-expressions" id="toc-conditional-expressions" class="nav-link active" data-scroll-target="#conditional-expressions"><span class="header-section-number">26.1</span> Conditional Expressions</a></li>
  <li><a href="#sec-case-study-fuel-2" id="toc-sec-case-study-fuel-2" class="nav-link" data-scroll-target="#sec-case-study-fuel-2"><span class="header-section-number">26.2</span> Case Study: U.S. Alternative Fueling Stations, Part II</a></li>
  <li><a href="#loops" id="toc-loops" class="nav-link" data-scroll-target="#loops"><span class="header-section-number">26.3</span> Loops</a></li>
  <li><a href="#sec-the-purrr-package" id="toc-sec-the-purrr-package" class="nav-link" data-scroll-target="#sec-the-purrr-package"><span class="header-section-number">26.4</span> The purrr Package</a>
  <ul class="collapse">
  <li><a href="#other-map-functions" id="toc-other-map-functions" class="nav-link" data-scroll-target="#other-map-functions"><span class="header-section-number">26.4.1</span> Other Map Functions</a></li>
  </ul></li>
  <li><a href="#sec-for-loops" id="toc-sec-for-loops" class="nav-link" data-scroll-target="#sec-for-loops"><span class="header-section-number">26.5</span> For Loops</a></li>
  <li><a href="#sec-how-to-write-loop" id="toc-sec-how-to-write-loop" class="nav-link" data-scroll-target="#sec-how-to-write-loop"><span class="header-section-number">26.6</span> How to Write a Loop</a></li>
  <li><a href="#sec-case-study-fuel-3" id="toc-sec-case-study-fuel-3" class="nav-link" data-scroll-target="#sec-case-study-fuel-3"><span class="header-section-number">26.7</span> Case Study: U.S. Alternative Fueling Stations, Part III</a></li>
  <li><a href="#case-study-ca-hospital-utilization" id="toc-case-study-ca-hospital-utilization" class="nav-link" data-scroll-target="#case-study-ca-hospital-utilization"><span class="header-section-number">26.8</span> Case Study: CA Hospital Utilization</a></li>
  <li><a href="#case-study-the-collatz-conjecture" id="toc-case-study-the-collatz-conjecture" class="nav-link" data-scroll-target="#case-study-the-collatz-conjecture"><span class="header-section-number">26.9</span> Case Study: The Collatz Conjecture</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/blob/main/chapters/week08/control-flow.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/week08/writing-functions.html">Week 8</a></li><li class="breadcrumb-item"><a href="../../chapters/week08/control-flow.html"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Control Flow</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Control Flow</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="callout callout-style-default callout-note callout-titled" title="Learning Goals">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="true" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Learning Goals
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse show">
<div class="callout-body-container callout-body">
<p>After this lesson, you should be able to:</p>
<ul>
<li>Create code that only runs when a condition is satisfied</li>
<li>Identify when a problem requires iteration</li>
<li>Select appropriate iteration strategies for problems</li>
<li>Explain what a map (or apply) function does</li>
<li>Call a function repeatedly with the purrr package’s map functions</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Required Packages">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Required Packages
</div>
</div>
<div class="callout-body-container callout-body">
<p>This chapter uses the following packages:</p>
<ul>
<li>dplyr</li>
<li>ggplot2</li>
<li>purrr</li>
<li>readxl</li>
<li>stringr</li>
</ul>
<p><a href="../week04/packages.html" class="quarto-xref"><span>Chapter 14</span></a> explains how to install and load packages.</p>
</div>
</div>
<p>Suppose you want to read and clean 10 different mass measurement datasets. All of the datasets have the same structure, so the code to read and clean them is the same. Based on what you learned in <a href="writing-functions.html" class="quarto-xref"><span>Chapter 25</span></a>, you decide to write a function, <code>read_mass_data</code>, and reuse the code. But you realize there are still two problems:</p>
<ol type="1">
<li>When you collected the 8th dataset, you forgot to tare the scale. As a result, all of the measurements are 50 grams too high. This is easy to correct by subtracting 50, but only the 8th dataset needs this correction. You need a way to choose which code to run based on a condition.</li>
<li>You still have to write 10 calls to <code>read_mass_data</code>. Using a programming language is supposed to help you avoid tedious things like this, and this wouldn’t scale well if you needed to read 100 or 1,000 datasets. You need a way to run code multiple times.</li>
</ol>
<p>Both of these problems are related to the order in which code runs (the flow of control). R provides several <strong>control flow</strong> expressions that change how code runs. You can use control flow expressions to choose which code to run based on a condition or to run code multiple times. Many of the concepts in this chapter generalize to other programming languages, which provide similar commands to alter control flow.</p>
<section id="conditional-expressions" class="level2" data-number="26.1">
<h2 data-number="26.1" class="anchored" data-anchor-id="conditional-expressions"><span class="header-section-number">26.1</span> Conditional Expressions</h2>
<p>A <strong>conditional</strong> expression is one where the computer must make a decision about which code to run next. The computer makes its decision by checking whether a condition is true. In a flowchart, a conditional looks like a branch (two or more ways to get somewhere):</p>
<div id="fig-conditional" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-conditional-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  start(Start) --&gt; condition{Is condition true?}
    condition -- True --&gt; do_something[Do something]
    condition -- False --&gt; do_something_else["Do something else"]
  do_something --&gt; done(End)
  do_something_else --&gt; done
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-conditional-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.1: A flowchart that shows a conditional. The computer checks a condition to decide which code to run.
</figcaption>
</figure>
</div>
<p>In most programming languages, the keyword <code>if</code> (or some variation of this) creates a conditional. Because of this, conditionals are also called <strong>if statements</strong>. In R, the syntax for a conditional is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (condition) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs if the condition is TRUE.</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs if the condition is FALSE.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The condition must return a single <code>TRUE</code> or <code>FALSE</code> value. The <code>else</code> part of the conditional is optional, so if you only want to do something in the true case, you can just write:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (condition) {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs if the condition is TRUE.</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>You can test multiple conditions by replacing the curly braces <code>{ }</code> after <code>else</code> with another conditional:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (condition1) {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs if condition1 is TRUE.</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (condition2) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs if condition2 is TRUE (and condition1 is FALSE).</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs if both condition1 and condition2 are FALSE.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>As an example, suppose we want our code to produce a different greeting depending on the hour:</p>
<ul>
<li>If it’s the morning (hours 6-11), the code should produce <code>"Good morning!"</code>.</li>
<li>If it’s the afternoon (hours 12-17), the code should produce <code>"Good   afternoon!"</code>.</li>
<li>For any other hour, the code should produce <code>"Hello."</code>.</li>
</ul>
<p>We can use a conditional to do this (see <a href="../week04/indexing.html#sec-logic" class="quarto-xref"><span>Section 15.4</span></a> if you need a refresher on how to write conditions that return <code>TRUE</code> and <code>FALSE</code> values):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>hour <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">11</span>) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  greeting <span class="ot">=</span> <span class="st">"Good morning!"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">17</span>) {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  greeting <span class="ot">=</span> <span class="st">"Good afternoon!"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  greeting <span class="ot">=</span> <span class="st">"Hello."</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>greeting</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Good morning!"</code></pre>
</div>
</div>
<p>Notice how changing the value of <code>hour</code> changes the result:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>hour <span class="ot">=</span> <span class="dv">13</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">11</span>) {</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  greeting <span class="ot">=</span> <span class="st">"Good morning!"</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">17</span>) {</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  greeting <span class="ot">=</span> <span class="st">"Good afternoon!"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  greeting <span class="ot">=</span> <span class="st">"Hello."</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>greeting</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Good afternoon!"</code></pre>
</div>
</div>
<p>Try out a few values for <code>hour</code> yourself. Then try modifying the code to give another greeting, <code>"Good evening!"</code> if it’s the evening (hours 18-19).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>In R, conditionals automatically return the value on the last line that runs (similar to functions). So another way to write the greeter example above is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>hour <span class="ot">=</span> <span class="dv">13</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>greeting <span class="ot">=</span> <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">6</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">11</span>) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Good morning!"</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (hour <span class="sc">&gt;=</span> <span class="dv">12</span> <span class="sc">&amp;&amp;</span> hour <span class="sc">&lt;=</span> <span class="dv">17</span>) {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Good afternoon!"</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Hello."</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>greeting</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Good afternoon!"</code></pre>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can <strong>nest</strong> one conditional inside the curly braces of another. Nesting is useful when you want to check a condition, do some computations, and then check another condition under the assumption that the first condition was <code>TRUE</code>.</p>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Conditionals correspond to <strong>special cases</strong> in your code. Having lots of special cases can make code harder to understand and maintain.</p>
<p>It’s not bad to use conditionals, but be mindful of how you use them. Think about whether there’s a more general way to do things instead. Be especially wary of nested conditionals.</p>
</div>
</div>
</section>
<section id="sec-case-study-fuel-2" class="level2" data-number="26.2">
<h2 data-number="26.2" class="anchored" data-anchor-id="sec-case-study-fuel-2"><span class="header-section-number">26.2</span> Case Study: U.S. Alternative Fueling Stations, Part II</h2>
<p>Let’s continue the U.S. Alternative Fueling Stations case study from <a href="writing-functions.html#sec-case-study-fuel-1" class="quarto-xref"><span>Section 25.5</span></a>. In the previous part, we wrote a function, <code>read_fuel_sheet</code>, to read and clean sheets from the dataset Excel file:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readxl"</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"stringr"</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>read_fuel_sheet <span class="ot">=</span> <span class="cf">function</span>(path, year) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">as.character</span>(year)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheet, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up the column names.</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">names</span>(stations)</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  is_dot_name <span class="ot">=</span> <span class="fu">str_starts</span>(names, <span class="fu">fixed</span>(<span class="st">"..."</span>))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  names[is_dot_name] <span class="ot">=</span> <span class="fu">as.character</span>(stations[<span class="dv">2</span>, is_dot_name])</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">str_to_lower</span>(names)</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(stations) <span class="ot">=</span> names</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove blank rows.</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">=</span> <span class="fu">filter</span>(stations, <span class="sc">!</span><span class="fu">is.na</span>(biodiesel))</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct column types and add year column.</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(stations<span class="sc">$</span>electric)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: hydrogen, propane</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  stations<span class="sc">$</span>year <span class="ot">=</span> year</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  stations</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We designed the function around the 2007 data sheet, but the format of the sheets changed in 2014. So the <code>read_fuel_sheet</code> function emits an error for 2014 and later. Let’s edit the function so that it works well for every year. We can use conditionals for code that should only run for some of the years.</p>
<p>To get started, let’s write code to read and clean the data for 2023, since it’s the last year. We can use the code in <code>read_fuel_sheet</code> as a reference. We’ll still use the readxl package’s <code>read_excel</code> function to read the sheet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"data/2007-2023_us_alt_fuels.xlsx"</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="st">"2023"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stations)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  State   Biodiesel   CNG   E85 Electrica               Hydrogenb   LNG Propanec
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;                   &lt;chr&gt;     &lt;dbl&gt; &lt;chr&gt;   
1 &lt;NA&gt;           NA    NA    NA (stations / charging o… (retail …    NA (primar…
2 &lt;NA&gt;           NA    NA    NA Level 1 / Level 2 / DC… &lt;NA&gt;         NA &lt;NA&gt;    
3 Alabama         9    28    34 424 | 1,096             0 | 0 | 0     2 25 | 36…
4 &lt;NA&gt;           NA    NA    NA 35 | 704 | 357          &lt;NA&gt;         NA &lt;NA&gt;    
5 Alaska          0     0     0 65 | 124                0 | 0 | 0     0 1 | 0 |…
6 &lt;NA&gt;           NA    NA    NA 3 | 87 | 34             &lt;NA&gt;         NA &lt;NA&gt;    
# ℹ 2 more variables: `Renewable Diesel` &lt;dbl&gt;, Totald &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This immediately reveals one reason why the <code>read_fuel_sheet</code> function didn’t work. For 2014 and later, all of the column names are in the 2nd row of the sheet. There’s no need to get names from other rows. Let’s make a note of this in a comment.</p>
<p>We still need to convert the column names to lowercase:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">names</span>(stations)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2014 and later, no need to get column names from two different rows.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">str_to_lower</span>(names)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>One of the columns is named <code>renewable diesel</code>, which will be difficult to use in analysis because it contains a space. We can use stringr’s <code>str_replace_all</code> to replace the space with an underscore:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">str_replace_all</span>(names, <span class="fu">fixed</span>(<span class="st">" "</span>), <span class="st">"_"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>names</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "state"            "biodiesel"        "cng"              "e85"             
 [5] "electrica"        "hydrogenb"        "lng"              "propanec"        
 [9] "renewable_diesel" "totald"          </code></pre>
</div>
</div>
<p>Four of the names seem incorrect: <code>electrica</code>, <code>hydrogenb</code>, <code>propanec</code>, and <code>totald</code>. If we examine the dataset with spreadsheet software, we can see that these column names have alphabetic superscripts in 2014 and later. There are many ways to fix this, but we’ll use dplyr’s <code>rename</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(stations) <span class="ot">=</span> names</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2014 and later:</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">rename</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  stations,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">electric =</span> electrica,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hydrogen =</span> hydrogenb,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">propane =</span> propanec,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> totald</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stations)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  state   biodiesel   cng   e85 electric hydrogen   lng propane renewable_diesel
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
1 &lt;NA&gt;           NA    NA    NA (statio… (retail…    NA (prima…               NA
2 &lt;NA&gt;           NA    NA    NA Level 1… &lt;NA&gt;        NA &lt;NA&gt;                  NA
3 Alabama         9    28    34 424 | 1… 0 | 0 |…     2 25 | 3…                0
4 &lt;NA&gt;           NA    NA    NA 35 | 70… &lt;NA&gt;        NA &lt;NA&gt;                  NA
5 Alaska          0     0     0 65 | 124 0 | 0 |…     0 1 | 0 …                0
6 &lt;NA&gt;           NA    NA    NA 3 | 87 … &lt;NA&gt;        NA &lt;NA&gt;                  NA
# ℹ 1 more variable: total &lt;dbl&gt;</code></pre>
</div>
</div>
<p>The next step in <code>read_fuel_sheet</code> is to remove blank rows (rows with missing values). The 2023 data frame has rows that are partially blank, but they do have values in the <code>electric</code> column. By inspecting the sheet, we can see that for 2014 and later, the <code>electric</code> column contains multiple values separated by the pipe character <code>|</code>. The <code>electric</code> values for each state are also split across two rows. Since we want to compare the data over time, we only need the station count, which is in the first row. So we’ll use the code from <code>read_fuel_sheet</code> that filters out the blank rows:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">filter</span>(stations, <span class="sc">!</span><span class="fu">is.na</span>(biodiesel))</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stations)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 10
  state   biodiesel   cng   e85 electric hydrogen   lng propane renewable_diesel
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
1 Alabama         9    28    34 424 | 1… 0 | 0 |…     2 25 | 3…                0
2 Alaska          0     0     0 65 | 124 0 | 0 |…     0 1 | 0 …                0
3 Arizona        77    26    21 1,198 |… 0 | 0 |…     5 42 | 3…                0
4 Arkans…        34    14    74 334 | 8… 0 | 0 |…     0 17 | 1…                0
5 Califo…        48   292   369 16,381 … 57 | 7 …    39 136 | …              597
6 Colora…         5    25    95 2,165 |… 0 | 1 |…     1 28 | 2…                0
# ℹ 1 more variable: total &lt;dbl&gt;</code></pre>
</div>
</div>
<p>With that done, let’s split the <code>electric</code> column into two columns, since it contains two values. The first value is the number of stations, which we’ll keep in the <code>electric</code> column. The second value is the number of outlets, which we’ll put in a column called <code>electric_outlets</code>. To make it easier to convert the columns to numbers, we’ll remove all of the commas (<code>,</code>) with stringr’s <code>str_replace_all</code> function. Then we can use stringr’s <code>str_split_fixed</code> function to split the column in two. Finally, we can use <code>as.numeric</code> to convert the columns to numbers before saving them back into the data frame:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2014 and later:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>electric <span class="ot">=</span> <span class="fu">str_replace_all</span>(stations<span class="sc">$</span>electric, <span class="fu">fixed</span>(<span class="st">","</span>), <span class="st">""</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>electric <span class="ot">=</span> <span class="fu">str_split_fixed</span>(electric, <span class="fu">fixed</span>(<span class="st">" | "</span>), <span class="dv">2</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">1</span>])</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>stations<span class="sc">$</span>electric_outlets <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The <code>hydrogen</code> and <code>propane</code> columns have the same problem. We’ll skip fixing them, since the code to do so is almost identical.</p>
<p>The 2023 data frame is now clean enough for analysis. The code to read and clean it is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="st">"2023"</span>, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">names</span>(stations)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2014 and later, no need to get column names from two different rows.</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">str_to_lower</span>(names)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>names <span class="ot">=</span> <span class="fu">str_replace_all</span>(names, <span class="fu">fixed</span>(<span class="st">" "</span>), <span class="st">"_"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(stations) <span class="ot">=</span> names</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2014 and later:</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">rename</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  stations,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">electric =</span> electrica,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">hydrogen =</span> hydrogenb,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">propane =</span> propanec,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">total =</span> totald</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">filter</span>(stations, <span class="sc">!</span><span class="fu">is.na</span>(biodiesel))</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a><span class="co"># For 2014 and later:</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>electric <span class="ot">=</span> <span class="fu">str_replace_all</span>(stations<span class="sc">$</span>electric, <span class="fu">fixed</span>(<span class="st">","</span>), <span class="st">""</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>electric <span class="ot">=</span> <span class="fu">str_split_fixed</span>(electric, <span class="fu">fixed</span>(<span class="st">" | "</span>), <span class="dv">2</span>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">1</span>])</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>stations<span class="sc">$</span>electric_outlets <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">2</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We can use conditionals to combine this with code in the body of the <code>read_fuel_sheet</code> function. Specifically, we need to check <code>year &lt; 2014</code> or <code>year &gt;= 2014</code> at a few points. One way to write the code for the combined function is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>read_fuel_sheet <span class="ot">=</span> <span class="cf">function</span>(path, year) {</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">as.character</span>(year)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheet, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up the column names.</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">names</span>(stations)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&lt;</span> <span class="dv">2014</span>) {</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    is_dot_name <span class="ot">=</span> <span class="fu">str_starts</span>(names, <span class="fu">fixed</span>(<span class="st">"..."</span>))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    names[is_dot_name] <span class="ot">=</span> <span class="fu">as.character</span>(stations[<span class="dv">2</span>, is_dot_name])</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">str_to_lower</span>(names)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">str_replace_all</span>(names, <span class="fu">fixed</span>(<span class="st">" "</span>), <span class="st">"_"</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(stations) <span class="ot">=</span> names</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&gt;=</span> <span class="dv">2014</span>) {</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    stations <span class="ot">=</span> <span class="fu">rename</span>(</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      stations,</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">electric =</span> electrica,</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">hydrogen =</span> hydrogenb,</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">propane =</span> propanec,</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">total =</span> totald</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove blank rows.</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">=</span> <span class="fu">filter</span>(stations, <span class="sc">!</span><span class="fu">is.na</span>(biodiesel))</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct column types and add year column.</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&gt;=</span> <span class="dv">2014</span>) {</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    electric <span class="ot">=</span> <span class="fu">str_replace_all</span>(stations<span class="sc">$</span>electric, <span class="fu">fixed</span>(<span class="st">","</span>), <span class="st">""</span>)</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    electric <span class="ot">=</span> <span class="fu">str_split_fixed</span>(electric, <span class="fu">fixed</span>(<span class="st">" | "</span>), <span class="dv">2</span>)</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">1</span>])</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    stations<span class="sc">$</span>electric_outlets <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">2</span>])</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: hydrogen, propane</span></span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(stations<span class="sc">$</span>electric)</span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: hydrogen, propane</span></span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>  stations<span class="sc">$</span>year <span class="ot">=</span> year</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  stations</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Notice how using multiple conditionals makes it harder to understand what the function does. We could instead use one conditional, but we’d have to repeat parts of the code that are the same. Alternatively, we could move some of the cleaning steps to other functions, so that <code>read_fuel_sheet</code> is shorter and easier to understand (without changing what it does).</p>
<p>Let’s test the new <code>read_fuel_sheet</code> function on the 2023 data:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_fuel_sheet</span>(path, <span class="dv">2023</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 12
   state  biodiesel   cng   e85 electric hydrogen   lng propane renewable_diesel
   &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
 1 Alaba…         9    28    34      424 0 | 0 |…     2 25 | 3…                0
 2 Alaska         0     0     0       65 0 | 0 |…     0 1 | 0 …                0
 3 Arizo…        77    26    21     1198 0 | 0 |…     5 42 | 3…                0
 4 Arkan…        34    14    74      334 0 | 0 |…     0 17 | 1…                0
 5 Calif…        48   292   369    16381 57 | 7 …    39 136 | …              597
 6 Color…         5    25    95     2165 0 | 1 |…     1 28 | 2…                0
 7 Conne…         1    13     3      865 0 | 0 |…     0 5 | 15…                0
 8 Delaw…         0     3     2      197 0 | 1 |…     0 7 | 12…                0
 9 Distr…         9     2     4      369 0 | 0 |…     0 0 | 6 …                0
10 Flori…         5    64   150     3430 0 | 0 |…     3 74 | 5…                0
# ℹ 42 more rows
# ℹ 3 more variables: total &lt;dbl&gt;, electric_outlets &lt;dbl&gt;, year &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We should also make sure that it still returns the same result for the 2007 data:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read_fuel_sheet</span>(path, <span class="dv">2007</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...5`
• `` -&gt; `...6`
• `` -&gt; `...8`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 × 10
   state       biodiesel   cng   e85 electric hydrogen   lng propane total  year
   &lt;chr&gt;           &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
 1 Alabama            13     3     3        0 0            0 52         71  2007
 2 Alaska              0     1     0        0 0            0 10         11  2007
 3 Arizona            10    37    13       12 1            3 58        134  2007
 4 Arkansas            3     3     4        0 0            0 41         51  2007
 5 California         39   186     6      367 23          29 206       856  2007
 6 Colorado           30    21    45        2 0            0 59        157  2007
 7 Connecticut         1    10     2        3 0            0 16         32  2007
 8 Delaware            3     1     1        0 0            0 3           8  2007
 9 District o…         1     1     3        0 1            0 0           6  2007
10 Florida            14    17    11        2 1            0 49         94  2007
# ℹ 42 more rows</code></pre>
</div>
</div>
<p>This looks good. We’ve now got a function that can read any of the years. In part III of this case study (<a href="#sec-case-study-fuel-3" class="quarto-xref"><span>Section 26.7</span></a>), we’ll see how to use the function to read all of them.</p>
</section>
<section id="loops" class="level2" data-number="26.3">
<h2 data-number="26.3" class="anchored" data-anchor-id="loops"><span class="header-section-number">26.3</span> Loops</h2>
<p>Computers are great at <strong>iterative</strong> tasks, where some of the steps need to be repeated. Examples of tasks like this include:</p>
<ul>
<li>Applying a transformation to (each element of) an entire column of data.</li>
<li>Computing distances between all pairs for a set of points.</li>
<li>Reading a collection of files in order to combine and analyze their data.</li>
<li>Simulating how a complex system evolves from one time step to the next.</li>
<li>Scraping the pages of a website.</li>
</ul>
<p>Each run of a repeated step is called an <strong>iteration</strong>. So in the example about reading a collection of files, one iteration means reading one file.</p>
<p>In programming languages, we use control flow expressions called <strong>loops</strong> to make the computer repeat some code. There are many different kinds of loops, but in a flowchart, they always look like a path that begins and ends at the same place (hence the name “loop”):</p>
<div id="fig-while-loop" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-while-loop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  start(Start) --&gt; condition{Is condition true?}
    condition -- True --&gt; body[Do something]
    body --&gt; condition
    condition -- False ----&gt; done(End)
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-while-loop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.2: A flowchart that shows a while loop (one kind of loop). The computer checks a condition at the beginning of each iteration to decide whether to continue iterating or stop.
</figcaption>
</figure>
</div>
<p>In R, there are four distinct categories of loops:</p>
<ol type="1">
<li>Vectorization, where a function is implicitly called on each element of a vector.</li>
<li>Map functions (&amp; apply functions), where a function is explicitly called on each element of a data structure.</li>
<li>For loops (&amp; while loops), where an expression is evaluated repeatedly until some condition is met.</li>
<li>Recursion, where a function calls itself.</li>
</ol>
<p>We introduced vectorization in <a href="../week03/data-types.html#sec-vectorization" class="quarto-xref"><span>Section 13.1.3</span></a>, several chapters ago. The next section, <a href="#sec-the-purrr-package" class="quarto-xref"><span>Section 26.4</span></a>, introduces the purrr package and map functions. <a href="#sec-for-loops" class="quarto-xref"><span>Section 26.5</span></a> introduces for loops. In <a href="#sec-how-to-write-loop" class="quarto-xref"><span>Section 26.6</span></a>, we’ll describe how to write loops to solve iterative problems and how to decide which kind of loop to use.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We don’t cover recursion because it tends to be difficult for people to understand. Recursion is also the least efficient kind of loop in R.</p>
</div>
</div>
</section>
<section id="sec-the-purrr-package" class="level2" data-number="26.4">
<h2 data-number="26.4" class="anchored" data-anchor-id="sec-the-purrr-package"><span class="header-section-number">26.4</span> The purrr Package</h2>
<p><a href="../week03/data-types.html#sec-vectorization" class="quarto-xref"><span>Section 13.1.3</span></a> introduced vectorization, a convenient and efficient way to compute multiple results. That section also mentioned that some of R’s functions—the ones that summarize or aggregate data—are not vectorized.</p>
<p>The <code>class</code> function is an example of a function that’s not vectorized. If we call the <code>class</code> function on the least terns dataset, we get just one result for the dataset as a whole:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(terns)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>We can get the class of a single column by selecting the column with <code>$</code>, the dollar sign operator:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(terns<span class="sc">$</span>year)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>What if we want the classes of all the columns? We could write a call to <code>class</code> for each column, but that would be tedious. When you’re working with a programming language, you should try to avoid tedium; there’s usually a better, more automated way.</p>
<p>Data frames are technically lists (<a href="../week03/data-types.html#sec-lists" class="quarto-xref"><span>Section 13.2.1</span></a>), where each column is one element. With that in mind, what we need here is a line of code that calls <code>class</code> on each element of the data frame. The idea is similar to vectorization, but since we have a list and a non-vectorized function, we have to do a bit more than just call <code>class(terns)</code>.</p>
<p>The <a href="https://purrr.tidyverse.org/">purrr</a> package is a collection of functions to help you do things repeatedly or for each element of a data structure. Install and load the package in order to follow along:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("purrr")</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"purrr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The package’s <code>map</code> function calls a function on each element of a vector, list, or other data structure. We say it <strong>maps</strong> or <strong>applies</strong> a function over the elements. In a flowchart, the <code>map</code> function looks like this:</p>
<div id="fig-for-loop" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-for-loop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  start(Start) --&gt; condition{Are there more elements?}
    condition -- Yes --&gt; get_elt["Get the next element"]
    get_elt --&gt; body[Do something]
    body --&gt; condition
    condition -- No ----&gt; done(End)
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-for-loop-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;26.3: A flowchart that shows a map function, apply function, or for loop. At the beginning of each iteration, the computer checks whether there is another element in the data to decide whether to continue iterating. If there is, the computer automatically assigns the next element to a variable.
</figcaption>
</figure>
</div>
<p>The syntax of the <code>map</code> function is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(data, fun, ...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The <code>map</code> function calls the function <code>fun</code> once for each element of <code>data</code>. It passes the element to <code>fun</code> as the first argument. It also passes the <code>...</code> arguments to <code>fun</code>, which are constant across all of the calls.</p>
<p>Let’s try this out with the least terns data and the <code>class</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(terns, class)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>$year
[1] "integer"

$site_name
[1] "character"

$site_name_2013_2018
[1] "character"

$site_name_1988_2001
[1] "character"

$site_abbr
[1] "character"

$region_3
[1] "character"

$region_4
[1] "character"

$event
[1] "character"

$bp_min
[1] "numeric"

$bp_max
[1] "numeric"

$fl_min
[1] "integer"

$fl_max
[1] "integer"

$total_nests
[1] "integer"

$nonpred_eggs
[1] "integer"

$nonpred_chicks
[1] "integer"

$nonpred_fl
[1] "integer"

$nonpred_ad
[1] "integer"

$pred_control
[1] "character"

$pred_eggs
[1] "integer"

$pred_chicks
[1] "integer"

$pred_fl
[1] "integer"

$pred_ad
[1] "integer"

$pred_pefa
[1] "character"

$pred_coy_fox
[1] "character"

$pred_meso
[1] "character"

$pred_owlspp
[1] "character"

$pred_corvid
[1] "character"

$pred_other_raptor
[1] "character"

$pred_other_avian
[1] "character"

$pred_misc
[1] "character"

$total_pefa
[1] "integer"

$total_coy_fox
[1] "integer"

$total_meso
[1] "integer"

$total_owlspp
[1] "integer"

$total_corvid
[1] "integer"

$total_other_raptor
[1] "integer"

$total_other_avian
[1] "integer"

$total_misc
[1] "integer"

$first_observed
[1] "character"

$last_observed
[1] "character"

$first_nest
[1] "character"

$first_chick
[1] "character"

$first_fledge
[1] "character"</code></pre>
</div>
</div>
<p>The result is similar to if the <code>class</code> function was vectorized. In fact, if we use a vector and a vectorized function with <code>map</code>, the result is nearly identical to the result from vectorization:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, pi)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sin</span>(x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.414710e-01 9.092974e-01 1.224647e-16</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(x, sin)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
[1] 0.841471

[[2]]
[1] 0.9092974

[[3]]
[1] 1.224647e-16</code></pre>
</div>
</div>
<p>The only difference is that the result from <code>map</code> is a list. In fact, the <code>map</code> function always returns a list with one element for each element of the input data.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you want to use <code>map</code> to repeat arbitrary code rather than a specific function, you can use <code>\()</code> or the <code>function</code> keyword to create an anonymous function (one that isn’t assigned to a variable). Then the syntax of the <code>map</code> function is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(data, \(element) {</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs once for each element in data.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Note: Apply Functions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note: Apply Functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>R’s <strong>apply functions</strong> are a built-in equivalent to map functions. The <code>lapply</code>, <code>sapply</code>, and <code>tapply</code> functions are the three most important functions in the family of apply functions, but there are many more. The <code>lapply</code> function is nearly identical to the <code>map</code> function.</p>
<p>We focus on and recommend the map functions rather than the apply functions because they are more consistent in their syntax and specific in their return types. You can learn more about R’s apply functions by reading <a href="https://stackoverflow.com/a/7141669">this StackOverflow post</a>.</p>
</div>
</div>
<section id="other-map-functions" class="level3" data-number="26.4.1">
<h3 data-number="26.4.1" class="anchored" data-anchor-id="other-map-functions"><span class="header-section-number">26.4.1</span> Other Map Functions</h3>
<p>The purrr package provides many different map functions, all of which have names that start with <code>map</code>. All of them call another function on each element of a data structure. They also all have the same syntax. Where they differ is in how they return results. A few of these are shown in <a href="#tbl-map-functions" class="quarto-xref">Table&nbsp;<span>26.1</span></a>.</p>
<div id="tbl-map-functions" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl quarto-uncaptioned" id="tbl-map-functions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;26.1
</figcaption>
<div aria-describedby="tbl-map-functions-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th>Function</th>
<th>Return Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>map_lgl</code></td>
<td>logical</td>
</tr>
<tr class="even">
<td><code>map_int</code></td>
<td>integer</td>
</tr>
<tr class="odd">
<td><code>map_dbl</code></td>
<td>numeric (double)</td>
</tr>
<tr class="even">
<td><code>map_chr</code></td>
<td>character</td>
</tr>
<tr class="odd">
<td><code>map</code></td>
<td>list</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<!--
When you have a choice between using vectorization or a map function, you
should always choose vectorization. Vectorization is clearer---compare the two
lines of code above---and it's also significantly more efficient. In fact,
vectorization is the most efficient way to call a function repeatedly in R.

As we saw with the `class` function, there are some situations where
vectorization is not possible. That's when you should think about using a map
function.
-->
<p>Let’s look at some examples of the other map functions. If we use <code>map_chr</code> to find the classes of the columns in the least terns data, we get a character vector:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_chr</span>(terns, class)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>               year           site_name site_name_2013_2018 site_name_1988_2001 
          "integer"         "character"         "character"         "character" 
          site_abbr            region_3            region_4               event 
        "character"         "character"         "character"         "character" 
             bp_min              bp_max              fl_min              fl_max 
          "numeric"           "numeric"           "integer"           "integer" 
        total_nests        nonpred_eggs      nonpred_chicks          nonpred_fl 
          "integer"           "integer"           "integer"           "integer" 
         nonpred_ad        pred_control           pred_eggs         pred_chicks 
          "integer"         "character"           "integer"           "integer" 
            pred_fl             pred_ad           pred_pefa        pred_coy_fox 
          "integer"           "integer"         "character"         "character" 
          pred_meso         pred_owlspp         pred_corvid   pred_other_raptor 
        "character"         "character"         "character"         "character" 
   pred_other_avian           pred_misc          total_pefa       total_coy_fox 
        "character"         "character"           "integer"           "integer" 
         total_meso        total_owlspp        total_corvid  total_other_raptor 
          "integer"           "integer"           "integer"           "integer" 
  total_other_avian          total_misc      first_observed       last_observed 
          "integer"           "integer"         "character"         "character" 
         first_nest         first_chick        first_fledge 
        "character"         "character"         "character" </code></pre>
</div>
</div>
<p>Likewise, if we use <code>map_dbl</code> to compute the <code>sin</code> values, we get a numeric vector, the same as from vectorization:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map_dbl</span>(x, sin)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.414710e-01 9.092974e-01 1.224647e-16</code></pre>
</div>
</div>
<p>In spite of that, vectorization is still more efficient than <code>sapply</code>, so use vectorization instead when possible.</p>
<!--
Map functions are incredibly useful for summarizing data. For example, suppose
we want to compute the frequencies for all of the columns in the least terns
dataset that aren't numeric.

First, we need to identify the columns. One way to do this is with the
`is.numeric` function. Despite the name, this function actually tests whether
its argument is a real number, not whether it its argument is a numeric vector.
In other words, it also returns true for integer values. We can use `map_lgl`
to apply this function to all of the columns in the least terns dataset:


::: {.cell}

```{.r .cell-code}
is_not_number = !map_lgl(terns, is.numeric)
is_not_number
```

::: {.cell-output .cell-output-stdout}

```
               year           site_name site_name_2013_2018 site_name_1988_2001 
              FALSE                TRUE                TRUE                TRUE 
          site_abbr            region_3            region_4               event 
               TRUE                TRUE                TRUE                TRUE 
             bp_min              bp_max              fl_min              fl_max 
              FALSE               FALSE               FALSE               FALSE 
        total_nests        nonpred_eggs      nonpred_chicks          nonpred_fl 
              FALSE               FALSE               FALSE               FALSE 
         nonpred_ad        pred_control           pred_eggs         pred_chicks 
              FALSE                TRUE               FALSE               FALSE 
            pred_fl             pred_ad           pred_pefa        pred_coy_fox 
              FALSE               FALSE                TRUE                TRUE 
          pred_meso         pred_owlspp         pred_corvid   pred_other_raptor 
               TRUE                TRUE                TRUE                TRUE 
   pred_other_avian           pred_misc          total_pefa       total_coy_fox 
               TRUE                TRUE               FALSE               FALSE 
         total_meso        total_owlspp        total_corvid  total_other_raptor 
              FALSE               FALSE               FALSE               FALSE 
  total_other_avian          total_misc      first_observed       last_observed 
              FALSE               FALSE                TRUE                TRUE 
         first_nest         first_chick        first_fledge 
               TRUE                TRUE                TRUE 
```


:::
:::


Is it worth using R code to identify the non-numeric columns? Since there are
only 43 columns in the least terns dataset, maybe not. But if the
dataset was larger, with say 100 columns, it definitely would be.

In general, it's a good habit to use R to do things rather than do them
manually. You'll get more practice programming, and your code will be more
flexible if you want to adapt it to other datasets.

Now that we know which columns are non-numeric, we can use the `table` function
to compute frequencies. We only want to compute frequencies for those columns,
so we need to subset the data:


::: {.cell}

```{.r .cell-code}
map(terns[, is_not_number], table)
```

::: {.cell-output .cell-output-stdout}

```
$site_name

                               ALAMEDA POINT 
                                          21 
                          ALBANY CENTRAL AVE 
                                           2 
                                ANAHEIM LAKE 
                                           3 
                            ARIZONA GLENDALE 
                                           1 
        BATIQUITOS LAGOON ECOLOGICAL RESERVE 
                                          21 
              BOLSA CHICA ECOLOGICAL RESERVE 
                                          21 
                               BURRIS ISLAND 
                                          18 
                CHULA VISTA WILDLIFE RESERVE 
                                          21 
                      COAL OIL POINT RESERVE 
                                          14 
           DSTREET FILL SWEETWATER MARSH NWR 
                                          21 
             EDEN LANDING ECOLOGICAL RESERVE 
                                          17 
                             FAIRBANKS RANCH 
                                           9 
                  GUADALUPE NIPOMO DUNES NWR 
                                           1 
                  HAYWARD REGIONAL SHORELINE 
                                          19 
                             HOLLYWOOD BEACH 
                                          18 
                      HUNTINGTON STATE BEACH 
                                          21 
                              KETTLEMAN CITY 
                                          15 
                                   LA HARBOR 
                                          21 
                               MALIBU LAGOON 
                                           7 
                          MCB CAMP PENDLETON 
                                          21 
                      MISSION BAY FAA ISLAND 
                                          21 
                  MISSION BAY MARINERS POINT 
                                          21 
             MISSION BAY NORTH FIESTA ISLAND 
                                          21 
           MISSION BAY SAN DIEGO RIVER MOUTH 
                                          14 
                     MISSION BAY STONY POINT 
                                          18 
                          MONTEZUMA WETLANDS 
                                          18 
             NAPA SONOMA MARSH WILDLIFE AREA 
                                          17 
                            NAS NORTH ISLAND 
                                          21 
              NAVAL AMPHIBIOUS BASE CORONADO 
                                          21 
                             NBVC POINT MUGU 
                                          21 
OCEANO DUNES STATE VEHICULAR RECREATION AREA 
                                          21 
                                ORMOND BEACH 
                                          21 
                       PITTSBURG POWER PLANT 
                                          15 
             RANCHO GUADALUPE DUNES PRESERVE 
                                          20 
                      SACRAMENTO BUFFERLANDS 
                                          10 
                                  SALTON SEA 
                                           7 
      SAN DIEGUITO LAGOON ECOLOGICAL RESERVE 
                                          10 
         SAN ELIJO LAGOON ECOLOGICAL RESERVE 
                                          21 
                           SAN PABLO BAY NWR 
                                           3 
       SANTA CLARA RIVER MCGRATH STATE BEACH 
                                          21 
  SATICOY UNITED WATER CONSERVATION DISTRICT 
                                           9 
                        SDIA LINDBERGH FIELD 
                                          21 
                  SEAL BEACH NWR ANAHEIM BAY 
                                          21 
                   SILVER STRAND STATE BEACH 
                                           1 
    SOUTH SAN DIEGO BAY UNIT SDNWR SALTWORKS 
                                          21 
                        TIJUANA ESTUARY NERR 
                                          21 
        UPPER NEWPORT BAY ECOLOGICAL RESERVE 
                                          21 
                              VANDENBERG SFB 
                                          21 
                                VENICE BEACH 
                                          21 

$site_name_2013_2018

                                                          
                                                        3 
                                            Alameda Point 
                                                       21 
                                             Anaheim Lake 
                                                        3 
                                        Batiquitos Lagoon 
                                                       21 
                                              Bolsa Chica 
                                                       21 
                                              Bufferlands 
                                                       10 
                                             Burris Basin 
                                                       18 
                                           Camp Pendleton 
                                                       21 
                              Chula Vista Wildlife Refuge 
                                                       21 
                                   Coal Oil Point Reserve 
                                                       14 
                                            D Street Fill 
                                                       21 
                          Eden Landing Ecological Reserve 
                                                       17 
                                               FAA Island 
                                                       21 
                                          Fairbanks Ranch 
                                                        9 
                               Hayward Regional Shoreline 
                                                       19 
                                          Hollywood Beach 
                                                       18 
                              Huntington Beach State Park 
                                                       21 
                                                Kettleman 
                                                       15 
             Lindbergh Field/Former Naval Training Center 
                                                       21 
                                            Malibu Lagoon 
                                                        7 
                                          Mariner's Point 
                                                       21 
                                                Montezuma 
                                                       18 
                                            NA_NO POLYGON 
                                                        5 
Napa Sonoma Marsh Wildlife Area Huichica Unit (Pond 7/7A) 
                                                       17 
                                      Naval Base Coronado 
                                                       42 
                                          NBVC Point Mugu 
                                                       21 
                                      North Fiesta Island 
                                                       21 
             Oceano Dunes State Vehicular Recreation Area 
                                                       21 
                                             Ormond Beach 
                                                       21 
                                    Pittsburg Power Plant 
                                                       15 
                                               Port of LA 
                                                       21 
                          Rancho Guadalupe Dunes Preserve 
                                                       20 
                                               Salton Sea 
                                                        7 
                                                Saltworks 
                                                       21 
                                    San Diego River Mouth 
                                                       14 
                                      San Diequito Lagoon 
                                                       10 
                                         San Elijo Lagoon 
                                                       21 
                                        Santa Clara River 
                                                       21 
               Saticoy United Water Conservation District 
                                                        9 
                      Seal Beach National Wildlife Refuge 
                                                       21 
                                              Stony Point 
                                                       18 
                                          Tijuana Estuary 
                                                       21 
                                        Upper Newport Bay 
                                                       21 
                                           Vandenberg AFB 
                                                       21 
                                             Venice Beach 
                                                       21 

$site_name_1988_2001

                      Albany Central Avenue  NA_2013_2018 POLYGON 
                    3                     2                   783 
        NA_NO POLYGON 
                    3 

$site_abbr

  AL_CENTAVE      ALAM_PT       ANA_LK     ARZ_GLEN         BCER         BLER 
           2           21            3            1           21           21 
     BUR_ISL     COAL_OIL           CV         D_ST         ELER     FAIR_RAN 
          18           14           21           21           17            9 
     GND_NWR HAY_REG_SHOR           HB          HSB      KET_CTY      LA_HARB 
           1           19           18           21           15           21 
     MAL_LAG       MB_FAA    MB_MAR_PT       MB_NFI   MB_SDRIV_S     MB_STONY 
           7           21           21           21           14           18 
       MCBCP         MONT          NAB        NASNI        NSMWA OCEANO_DUNES 
          21           18           21           21           17           21 
      ORMOND   PITT_POWER      PT_MUGU         RGDP   S_CLAR_MCG      SAC_BUF 
          21           15           21           20           21           10 
        SALT     SALT_SEA    SAN_ELIJO SANDIEGU_LAG      SAT_WCD      SDIA_LF 
          21            7           21           10            9           21 
SEAL_BCH_NWR     SLVRSTRD       SPBNWR       TJ_RIV        UNBER      VAN_SFB 
          21            1            3           21           21           21 
     VEN_BCH 
          21 

$region_3

   ARIZONA    CENTRAL      KINGS   S.F._BAY SACRAMENTO   SOUTHERN 
         1         77         15        112         10        576 

$region_4

   ARIZONA    CENTRAL      KINGS   S.F._BAY SACRAMENTO   SOUTHERN    VENTURA 
         1         77         15        112         10        486         90 

$event

EL_NINO LA_NINA NEUTRAL 
    120     258     413 

$pred_control

      N   Y 
342 134 315 

$pred_pefa

      N   Y 
143 423 225 

$pred_coy_fox

      N   Y 
142 535 114 

$pred_meso

      N   Y 
142 552  97 

$pred_owlspp

      N   Y 
142 531 118 

$pred_corvid

      N   Y 
142 423 226 

$pred_other_raptor

      N  NN   Y 
145 437   1 208 

$pred_other_avian

      N   Y 
143 395 253 

$pred_misc

      N   Y 
159 415 217 

$first_observed

           2000-04-16 2000-04-19 2000-04-21 2000-04-22 2000-04-23 2000-04-26 
       141          1          1          1          1          1          1 
2000-04-28 2000-05-01 2000-05-04 2000-05-06 2000-05-07 2000-05-09 2000-05-11 
         5          1          3          1          2          1          1 
2000-05-21 2000-06-06 2000-06-10 2004-04-08 2004-04-11 2004-04-12 2004-04-21 
         1          1          1          1          1          2          1 
2004-04-22 2004-04-23 2004-04-27 2004-04-30 2004-05-01 2004-05-03 2004-05-07 
         2          1          1          1          1          2          1 
2004-05-09 2004-05-10 2004-05-14 2004-05-17 2004-05-31 2004-06-03 2005-04-14 
         1          1          1          1          1          1          1 
2005-04-15 2005-04-18 2005-04-19 2005-04-20 2005-04-21 2005-04-22 2005-04-23 
         1          2          1          2          2          1          2 
2005-04-24 2005-04-28 2005-04-29 2005-04-30 2005-05-01 2005-05-05 2005-05-07 
         1          2          1          1          1          1          1 
2005-05-08 2005-05-10 2005-05-13 2005-05-27 2005-05-28 2006-04-08 2006-04-10 
         1          1          1          1          1          2          1 
2006-04-13 2006-04-15 2006-04-16 2006-04-20 2006-04-22 2006-04-27 2006-04-28 
         1          1          1          1          3          1          1 
2006-05-01 2006-05-03 2006-05-08 2006-05-10 2006-05-14 2006-05-15 2006-05-20 
         1          2          1          1          2          1          1 
2006-06-23 2006-06-24 2007-04-16 2007-04-18 2007-04-22 2007-04-23 2007-04-24 
         1          1          1          1          1          1          2 
2007-04-25 2007-04-26 2007-04-28 2007-05-01 2007-05-02 2007-05-03 2007-05-11 
         4          2          1          3          3          1          1 
2007-05-13 2007-05-14 2007-05-18 2007-05-24 2007-06-02 2007-06-06 2007-06-08 
         2          1          1          1          1          1          1 
2008-04-11 2008-04-16 2008-04-23 2008-04-24 2008-04-25 2008-04-27 2008-04-28 
         1          2          1          4          1          3          3 
2008-05-01 2008-05-04 2008-05-05 2008-05-07 2008-05-08 2008-05-09 2008-05-12 
         1          1          1          1          1          2          1 
2008-05-14 2008-05-15 2008-05-21 2008-05-22 2008-05-24 2008-05-28 2008-05-31 
         1          1          1          1          1          1          1 
2009-04-16 2009-04-19 2009-04-22 2009-04-23 2009-04-24 2009-04-25 2009-04-26 
         2          1          1          4          2          1          3 
2009-04-29 2009-04-30 2009-05-02 2009-05-03 2009-05-04 2009-05-05 2009-05-06 
         1          1          1          2          1          1          1 
2009-05-08 2009-05-11 2009-05-13 2009-05-28 2010-04-14 2010-04-16 2010-04-17 
         3          1          2          1          1          2          1 
2010-04-18 2010-04-19 2010-04-21 2010-04-22 2010-04-25 2010-04-27 2010-04-28 
         2          1          1          2          2          1          1 
2010-04-29 2010-05-01 2010-05-02 2010-05-04 2010-05-06 2010-05-07 2010-05-13 
         1          1          1          1          1          1          2 
2010-05-14 2010-05-15 2010-05-16 2010-05-26 2010-05-29 2010-05-30 2010-06-09 
         2          4          1          1          1          1          1 
2011-04-09 2011-04-15 2011-04-18 2011-04-20 2011-04-21 2011-04-22 2011-04-24 
         1          1          1          1          5          2          1 
2011-04-25 2011-04-27 2011-04-28 2011-04-29 2011-05-01 2011-05-04 2011-05-05 
         1          1          1          1          1          1          2 
2011-05-07 2011-05-08 2011-05-11 2011-05-12 2011-05-14 2011-05-28 2011-06-11 
         1          1          1          1          3          1          1 
2011-06-14 2011-06-25 2012-04-14 2012-04-15 2012-04-17 2012-04-18 2012-04-19 
         1          1          2          1          2          3          5 
2012-04-20 2012-04-21 2012-04-22 2012-04-25 2012-04-29 2012-05-01 2012-05-03 
         1          2          2          1          2          1          1 
2012-05-06 2012-05-08 2012-05-10 2012-05-11 2012-05-13 2012-05-14 2012-05-23 
         1          1          3          1          1          1          1 
2012-05-30 2012-06-09 2013-04-14 2013-04-15 2013-04-18 2013-04-21 2013-04-24 
         1          1          1          1          1          1          2 
2013-04-25 2013-04-29 2013-04-30 2013-05-01 2013-05-02 2013-05-03 2013-05-07 
         1          1          1          2          2          3          1 
2013-05-10 2013-05-11 2013-05-12 2013-05-13 2013-05-15 2013-05-17 2013-05-19 
         1          1          1          1          1          1          1 
2013-05-27 2013-06-01 2013-06-09 2013-06-30 2013-07-19 2014-04-15 2014-04-17 
         1          2          1          1          1          2          5 
2014-04-19 2014-04-21 2014-04-24 2014-04-25 2014-04-26 2014-04-30 2014-05-01 
         1          1          1          2          1          1          1 
2014-05-02 2014-05-04 2014-05-08 2014-05-09 2014-05-10 2014-05-11 2014-05-16 
         1          2          1          2          2          1          1 
2014-05-22 2014-05-24 2014-05-25 2014-05-31 2015-04-06 2015-04-15 2015-04-17 
         1          2          1          1          1          2          2 
2015-04-18 2015-04-19 2015-04-22 2015-04-23 2015-04-27 2015-04-29 2015-04-30 
         1          3          3          1          1          2          3 
2015-05-01 2015-05-07 2015-05-08 2015-05-09 2015-05-14 2015-05-17 2015-05-20 
         3          1          2          1          2          1          1 
2015-05-30 2015-06-05 2015-07-05 2015-07-07 2015-07-22 2016-04-10 2016-04-11 
         1          1          1          1          1          2          1 
2016-04-12 2016-04-13 2016-04-14 2016-04-15 2016-04-18 2016-04-20 2016-04-21 
         1          1          2          1          2          1          1 
2016-04-23 2016-04-26 2016-04-30 2016-05-01 2016-05-02 2016-05-03 2016-05-04 
         1          1          2          1          1          2          1 
2016-05-06 2016-05-07 2016-05-11 2016-05-12 2016-05-14 2016-05-18 2016-05-25 
         2          2          2          1          1          2          1 
2016-05-31 2016-06-12 2016-06-16 2016-06-18 2016-07-15 2017-04-13 2017-04-14 
         1          1          1          2          1          2          1 
2017-04-15 2017-04-16 2017-04-17 2017-04-18 2017-04-19 2017-04-20 2017-04-21 
         2          1          2          2          1          1          1 
2017-04-22 2017-04-24 2017-04-26 2017-04-29 2017-05-04 2017-05-06 2017-05-07 
         1          1          1          1          2          3          2 
2017-05-10 2017-05-11 2017-05-12 2017-05-19 2017-05-25 2017-06-03 2017-07-02 
         3          2          1          1          2          1          1 
2017-07-04 2018-03-25 2018-03-30 2018-04-13 2018-04-18 2018-04-19 2018-04-20 
         1          1          1          2          1          2          3 
2018-04-21 2018-04-25 2018-04-26 2018-04-27 2018-04-28 2018-04-29 2018-05-04 
         2          2          1          1          4          2          1 
2018-05-05 2018-05-10 2018-05-11 2018-05-13 2018-05-16 2018-05-20 2018-05-21 
         1          2          1          1          1          1          1 
2019-04-06 2019-04-12 2019-04-14 2019-04-17 2019-04-18 2019-04-19 2019-04-20 
         1          3          1          1          1          3          2 
2019-04-22 2019-04-24 2019-04-26 2019-04-27 2019-05-01 2019-05-02 2019-05-03 
         1          1          1          4          1          1          2 
2019-05-06 2019-05-08 2019-05-09 2019-05-10 2019-05-11 2019-05-12 2020-04-06 
         2          1          2          1          3          1          1 
2020-04-10 2020-04-11 2020-04-17 2020-04-18 2020-04-20 2020-04-21 2020-04-23 
         1          1          2          1          2          1          1 
2020-04-24 2020-04-25 2020-04-26 2020-04-29 2020-04-30 2020-05-01 2020-05-02 
         2          2          2          2          2          1          1 
2020-05-06 2020-05-08 2020-05-09 2020-05-10 2020-05-14 2020-05-17 2020-06-24 
         2          3          3          1          1          1          1 
2021-04-10 2021-04-12 2021-04-13 2021-04-17 2021-04-18 2021-04-19 2021-04-21 
         1          1          1          1          1          2          4 
2021-04-22 2021-04-23 2021-04-24 2021-04-25 2021-04-27 2021-04-28 2021-04-29 
         3          1          2          1          1          2          2 
2021-05-01 2021-05-06 2021-05-11 2021-05-13 2021-05-16 2021-05-21 2021-05-26 
         1          2          1          2          1          1          1 
2021-05-27 2021-06-04 2021-06-16 2022-04-10 2022-04-13 2022-04-15 2022-04-17 
         1          1          1          1          1          1          2 
2022-04-18 2022-04-21 2022-04-22 2022-04-23 2022-04-24 2022-04-26 2022-04-28 
         2          2          2          1          1          2          2 
2022-04-30 2022-05-05 2022-05-06 2022-05-08 2022-05-11 2022-05-14 2022-05-15 
         3          1          2          2          1          1          1 
2022-05-17 2022-05-19 2022-05-25 2022-05-29 2023-04-15 2023-04-18 2023-04-20 
         2          2          1          1          1          1          2 
2023-04-22 2023-04-23 2023-04-24 2023-04-26 2023-04-27 2023-04-28 2023-04-29 
         2          4          1          1          1          2          1 
2023-04-30 2023-05-01 2023-05-03 2023-05-04 2023-05-06 2023-05-07 2023-05-10 
         2          1          1          1          1          2          1 
2023-05-11 2023-05-17 2023-05-19 2023-05-24 2023-05-25 2023-05-27 2023-05-28 
         2          1          1          1          1          1          2 
2023-07-23 2023-08-04 2028-04-19 
         1          1          1 

$last_observed

           2000-07-21 2000-08-05 2000-08-12 2000-08-13 2000-08-14 2000-08-17 
       149          1          2          1          2          1          1 
2000-08-18 2000-08-19 2000-08-20 2000-08-24 2000-08-26 2000-08-30 2000-08-31 
         1          1          3          1          1          1          1 
2000-09-01 2000-09-05 2000-09-06 2000-09-07 2000-09-15 2000-09-24 2004-06-14 
         1          1          1          1          1          1          1 
2004-07-01 2004-07-18 2004-07-21 2004-07-22 2004-07-23 2004-08-02 2004-08-06 
         2          1          1          1          1          1          1 
2004-08-09 2004-08-10 2004-08-13 2004-08-16 2004-08-19 2004-08-22 2004-08-23 
         1          1          1          1          1          1          1 
2004-08-24 2004-09-03 2004-09-09 2004-09-10 2005-06-10 2005-06-17 2005-06-24 
         1          1          1          1          1          1          1 
2005-06-29 2005-07-07 2005-07-23 2005-07-26 2005-07-28 2005-07-29 2005-07-31 
         1          1          1          1          1          1          1 
2005-08-03 2005-08-05 2005-08-13 2005-08-15 2005-08-17 2005-08-18 2005-08-24 
         1          1          1          1          1          1          1 
2005-08-26 2005-08-27 2005-08-29 2005-09-08 2005-09-12 2005-09-15 2006-06-18 
         2          1          1          2          1          1          1 
2006-06-27 2006-07-13 2006-07-23 2006-07-29 2006-08-05 2006-08-07 2006-08-09 
         1          1          1          1          1          2          1 
2006-08-11 2006-08-16 2006-08-17 2006-08-18 2006-08-31 2006-09-02 2006-09-05 
         1          2          1          1          1          1          1 
2006-09-10 2006-09-11 2006-09-13 2006-09-17 2006-09-18 2007-06-24 2007-07-18 
         1          1          1          1          1          1          1 
2007-08-01 2007-08-06 2007-08-08 2007-08-10 2007-08-11 2007-08-15 2007-08-17 
         1          1          1          1          1          2          1 
2007-08-19 2007-08-20 2007-08-22 2007-08-24 2007-08-25 2007-09-02 2007-09-06 
         3          3          1          2          3          1          1 
2007-09-08 2007-09-09 2007-09-12 2007-09-15 2008-06-09 2008-06-10 2008-06-14 
         1          1          1          1          1          1          1 
2008-06-27 2008-07-18 2008-07-31 2008-08-05 2008-08-07 2008-08-10 2008-08-13 
         1          2          1          1          1          1          1 
2008-08-15 2008-08-17 2008-08-19 2008-08-21 2008-08-24 2008-08-26 2008-08-28 
         1          3          1          1          1          1          1 
2008-08-29 2008-08-31 2008-09-01 2008-09-04 2008-09-19 2008-09-20 2009-06-10 
         3          2          1          1          1          1          1 
2009-07-13 2009-07-17 2009-07-18 2009-07-24 2009-07-26 2009-07-30 2009-08-01 
         1          2          1          1          1          1          1 
2009-08-05 2009-08-06 2009-08-07 2009-08-10 2009-08-11 2009-08-12 2009-08-13 
         1          1          1          1          1          1          2 
2009-08-14 2009-08-15 2009-08-19 2009-08-20 2009-08-21 2009-08-22 2009-08-24 
         1          1          1          1          1          1          1 
2009-08-25 2009-08-27 2009-09-05 2009-09-26 2009-09-27 2010-07-01 2010-07-17 
         1          1          1          1          1          2          1 
2010-07-21 2010-07-22 2010-07-27 2010-07-29 2010-07-30 2010-08-01 2010-08-04 
         1          1          1          3          2          1          1 
2010-08-05 2010-08-07 2010-08-09 2010-08-11 2010-08-12 2010-08-13 2010-08-14 
         1          1          1          2          4          1          1 
2010-08-15 2010-08-17 2010-08-18 2010-08-21 2010-08-23 2010-08-26 2010-09-01 
         1          1          1          1          1          1          1 
2010-09-03 2011-06-25 2011-07-06 2011-07-19 2011-07-21 2011-07-26 2011-07-27 
         1          1          1          1          1          1          1 
2011-07-29 2011-07-31 2011-08-01 2011-08-02 2011-08-03 2011-08-04 2011-08-05 
         3          1          1          1          1          1          1 
2011-08-06 2011-08-10 2011-08-11 2011-08-13 2011-08-15 2011-08-17 2011-08-18 
         2          1          1          1          1          1          1 
2011-08-20 2011-08-22 2011-08-23 2011-08-24 2011-08-26 2011-08-27 2012-06-13 
         1          1          1          1          1          3          1 
2012-06-16 2012-06-19 2012-06-22 2012-07-01 2012-07-10 2012-07-12 2012-07-13 
         1          1          1          1          1          1          2 
2012-07-17 2012-07-19 2012-07-22 2012-07-24 2012-07-25 2012-07-27 2012-08-01 
         1          1          1          1          1          1          1 
2012-08-05 2012-08-06 2012-08-08 2012-08-09 2012-08-10 2012-08-11 2012-08-12 
         1          1          1          1          2          1          1 
2012-08-16 2012-08-25 2012-08-26 2012-08-31 2012-09-01 2012-09-15 2013-05-09 
         1          1          2          1          1          2          1 
2013-06-07 2013-06-09 2013-06-10 2013-06-23 2013-06-26 2013-06-28 2013-07-01 
         1          1          1          1          1          1          1 
2013-07-10 2013-07-11 2013-07-21 2013-07-26 2013-07-28 2013-08-01 2013-08-02 
         1          1          1          1          1          1          1 
2013-08-03 2013-08-08 2013-08-11 2013-08-12 2013-08-16 2013-08-17 2013-08-21 
         1          1          2          1          1          1          3 
2013-08-26 2013-08-30 2013-09-02 2014-04-21 2014-05-03 2014-06-13 2014-06-29 
         2          1          1          1          1          1          1 
2014-07-15 2014-07-16 2014-07-24 2014-07-25 2014-07-26 2014-07-27 2014-08-02 
         1          3          1          1          1          1          1 
2014-08-03 2014-08-06 2014-08-07 2014-08-09 2014-08-10 2014-08-13 2014-08-14 
         2          2          1          1          1          1          2 
2014-08-15 2014-08-16 2014-08-24 2014-08-30 2014-09-06 2014-09-11 2014-09-16 
         1          1          1          1          1          1          1 
2015-05-12 2015-06-19 2015-06-22 2015-07-05 2015-07-09 2015-07-16 2015-07-17 
         1          1          1          1          1          2          1 
2015-07-23 2015-07-24 2015-07-27 2015-07-28 2015-07-29 2015-07-30 2015-07-31 
         1          2          1          1          3          1          1 
2015-08-03 2015-08-04 2015-08-06 2015-08-07 2015-08-09 2015-08-14 2015-08-15 
         1          1          1          1          1          1          1 
2015-08-16 2015-08-19 2015-08-20 2015-08-21 2015-08-23 2015-08-30 2015-09-02 
         1          1          2          1          1          1          1 
2015-09-03 2015-09-06 2016-06-02 2016-07-07 2016-07-10 2016-07-13 2016-07-14 
         1          1          1          1          1          2          2 
2016-07-15 2016-07-17 2016-07-20 2016-07-27 2016-07-28 2016-07-30 2016-07-31 
         3          1          2          1          2          1          1 
2016-08-02 2016-08-03 2016-08-04 2016-08-06 2016-08-11 2016-08-12 2016-08-14 
         1          2          1          3          1          1          1 
2016-08-15 2016-08-18 2016-08-24 2016-08-25 2016-08-26 2016-08-28 2016-09-02 
         1          3          2          1          1          1          1 
2016-09-03 2017-05-17 2017-05-21 2017-06-07 2017-06-24 2017-07-12 2017-07-17 
         1          1          1          1          1          2          1 
2017-07-21 2017-07-22 2017-07-23 2017-07-24 2017-07-28 2017-07-29 2017-07-30 
         1          1          1          1          1          1          1 
2017-07-31 2017-08-03 2017-08-04 2017-08-05 2017-08-10 2017-08-12 2017-08-13 
         1          2          1          1          2          1          3 
2017-08-18 2017-08-19 2017-08-21 2017-08-23 2017-08-24 2017-08-26 2017-08-30 
         1          1          1          1          1          2          1 
2017-09-11 2018-06-21 2018-06-23 2018-06-25 2018-07-05 2018-07-13 2018-07-16 
         2          1          1          1          1          1          1 
2018-07-21 2018-07-22 2018-07-23 2018-07-25 2018-07-26 2018-07-28 2018-07-29 
         1          1          1          2          1          1          1 
2018-07-30 2018-08-01 2018-08-02 2018-08-04 2018-08-08 2018-08-12 2018-08-15 
         1          1          2          2          1          1          1 
2018-08-23 2018-08-26 2018-08-29 2018-09-03 2018-09-06 2018-09-10 2019-05-20 
         1          1          3          1          1          1          1 
2019-06-12 2019-07-03 2019-07-18 2019-07-21 2019-07-24 2019-07-25 2019-07-26 
         2          1          1          1          1          1          1 
2019-07-30 2019-07-31 2019-08-01 2019-08-08 2019-08-09 2019-08-10 2019-08-12 
         1          1          1          1          2          1          1 
2019-08-14 2019-08-17 2019-08-18 2019-08-19 2019-08-21 2019-08-24 2019-08-26 
         2          1          1          2          2          2          1 
2019-08-27 2019-08-31 2019-09-06 2019-09-08 2019-09-16 2020-06-21 2020-07-02 
         1          1          1          1          1          1          1 
2020-07-15 2020-07-23 2020-07-26 2020-08-03 2020-08-05 2020-08-09 2020-08-11 
         1          3          1          1          1          1          2 
2020-08-12 2020-08-13 2020-08-14 2020-08-16 2020-08-19 2020-08-20 2020-08-22 
         2          3          1          1          2          1          1 
2020-08-26 2020-08-27 2020-08-28 2020-08-30 2020-09-04 2020-09-09 2020-09-12 
         2          2          1          1          1          1          2 
2020-09-17 2021-05-12 2021-06-03 2021-06-04 2021-06-06 2021-06-08 2021-07-04 
         1          1          1          1          1          1          1 
2021-07-11 2021-07-14 2021-07-24 2021-07-29 2021-08-01 2021-08-02 2021-08-03 
         1          1          1          1          1          1          1 
2021-08-04 2021-08-05 2021-08-11 2021-08-12 2021-08-13 2021-08-15 2021-08-18 
         1          1          2          1          2          1          2 
2021-08-19 2021-08-20 2021-08-21 2021-08-22 2021-08-26 2021-08-29 2021-09-01 
         1          2          1          1          1          1          1 
2021-09-10 2021-09-18 2021-09-23 2022-05-15 2022-05-27 2022-06-15 2022-06-29 
         1          1          2          1          1          1          1 
2022-07-01 2022-07-09 2022-07-18 2022-07-19 2022-07-21 2022-07-22 2022-07-25 
         1          1          1          1          1          1          1 
2022-07-26 2022-07-27 2022-07-31 2022-08-01 2022-08-02 2022-08-05 2022-08-06 
         1          1          2          1          1          1          2 
2022-08-09 2022-08-10 2022-08-11 2022-08-12 2022-08-17 2022-08-18 2022-08-19 
         1          1          1          1          1          1          1 
2022-08-24 2022-08-25 2022-08-28 2022-09-01 2022-09-02 2022-09-13 2023-05-28 
         1          1          2          1          1          1          1 
2023-06-14 2023-07-15 2023-07-26 2023-07-28 2023-07-29 2023-07-30 2023-08-02 
         1          1          2          1          1          1          1 
2023-08-03 2023-08-04 2023-08-09 2023-08-16 2023-08-17 2023-08-19 2023-08-20 
         1          2          2          2          1          4          1 
2023-08-24 2023-08-25 2023-08-26 2023-08-27 2023-08-28 2023-08-31 2023-09-02 
         1          1          1          1          1          2          2 
2023-09-09 2023-09-11 2023-09-22 
         2          1          2 

$first_nest

           2000-05-05 2000-05-09 2000-05-10 2000-05-11 2000-05-13 2000-05-16 
       189          1          2          3          1          3          1 
2000-05-18 2000-05-19 2000-05-26 2000-05-28 2000-05-29 2000-05-31 2000-06-01 
         2          1          1          2          1          1          1 
2000-06-06 2000-06-08 2000-06-17 2004-05-05 2004-05-08 2004-05-09 2004-05-11 
         1          1          1          1          1          1          1 
2004-05-13 2004-05-14 2004-05-15 2004-05-16 2004-05-19 2004-05-20 2004-05-21 
         2          1          1          2          2          1          1 
2004-05-22 2004-05-26 2004-05-27 2004-05-28 2004-06-03 2004-06-06 2004-06-14 
         1          1          1          1          1          1          1 
2004-06-17 2005-05-04 2005-05-06 2005-05-07 2005-05-08 2005-05-11 2005-05-12 
         1          1          3          1          1          1          3 
2005-05-13 2005-05-14 2005-05-17 2005-05-18 2005-05-19 2005-05-20 2005-05-21 
         1          2          1          1          1          1          1 
2005-05-26 2005-05-28 2005-06-03 2005-06-10 2005-06-15 2005-06-16 2006-05-10 
         2          1          1          1          1          1          1 
2006-05-12 2006-05-14 2006-05-15 2006-05-17 2006-05-18 2006-05-20 2006-05-22 
         3          1          1          2          1          3          3 
2006-05-23 2006-05-25 2006-05-27 2006-06-01 2006-06-09 2006-06-10 2006-06-21 
         1          1          2          1          1          1          1 
2007-05-12 2007-05-14 2007-05-16 2007-05-17 2007-05-18 2007-05-19 2007-05-22 
         1          1          3          4          1          2          1 
2007-05-23 2007-05-25 2007-05-26 2007-05-31 2007-06-02 2007-06-04 2007-06-05 
         1          1          2          1          1          1          1 
2007-06-06 2007-06-08 2007-06-17 2007-06-21 2007-06-27 2008-05-06 2008-05-07 
         1          2          1          1          1          1          1 
2008-05-09 2008-05-10 2008-05-12 2008-05-15 2008-05-16 2008-05-17 2008-05-18 
         1          1          2          2          3          2          3 
2008-05-21 2008-05-23 2008-05-26 2008-05-28 2008-05-31 2008-06-05 2008-06-11 
         2          1          1          1          1          3          1 
2008-06-19 2009-05-03 2009-05-04 2009-05-06 2009-05-07 2009-05-09 2009-05-10 
         1          1          1          1          1          2          1 
2009-05-12 2009-05-13 2009-05-14 2009-05-18 2009-05-20 2009-05-21 2009-05-24 
         2          2          4          1          2          1          2 
2009-06-03 2009-06-06 2009-06-08 2009-06-14 2009-07-29 2010-05-01 2010-05-05 
         1          2          1          1          1          1          2 
2010-05-06 2010-05-07 2010-05-08 2010-05-09 2010-05-13 2010-05-14 2010-05-16 
         3          1          1          1          3          4          2 
2010-05-21 2010-05-22 2010-05-25 2010-05-27 2010-05-28 2010-06-04 2010-06-05 
         1          2          1          2          1          2          1 
2010-06-06 2010-06-09 2010-06-12 2010-06-17 2010-06-18 2011-04-30 2011-05-02 
         1          1          1          1          1          1          1 
2011-05-04 2011-05-06 2011-05-08 2011-05-09 2011-05-12 2011-05-14 2011-05-15 
         1          2          1          2          2          2          3 
2011-05-17 2011-05-18 2011-05-20 2011-05-21 2011-05-28 2011-05-29 2011-06-02 
         1          2          1          1          2          3          1 
2011-06-07 2011-06-08 2011-06-11 2012-04-30 2012-05-02 2012-05-04 2012-05-07 
         1          1          1          1          1          3          1 
2012-05-08 2012-05-09 2012-05-10 2012-05-11 2012-05-12 2012-05-13 2012-05-14 
         1          1          4          4          1          1          2 
2012-05-15 2012-05-16 2012-05-20 2012-05-24 2012-05-26 2012-05-29 2012-05-30 
         1          1          2          1          1          1          1 
2012-06-01 2012-06-11 2013-05-02 2013-05-03 2013-05-06 2013-05-09 2013-05-10 
         1          1          1          2          1          1          2 
2013-05-11 2013-05-12 2013-05-13 2013-05-14 2013-05-15 2013-05-16 2013-05-17 
         2          1          1          2          1          3          1 
2013-05-26 2013-06-01 2013-06-02 2013-06-06 2013-06-07 2013-06-29 2013-08-15 
         3          2          1          1          2          1          1 
2014-04-29 2014-05-01 2014-05-03 2014-05-08 2014-05-09 2014-05-10 2014-05-11 
         1          1          1          3          4          2          1 
2014-05-12 2014-05-14 2014-05-16 2014-05-17 2014-05-21 2014-05-22 2014-05-24 
         2          2          2          1          1          2          2 
2014-05-28 2014-05-29 2014-05-31 2014-06-01 2014-07-05 2015-04-27 2015-05-03 
         1          2          1          1          1          1          1 
2015-05-06 2015-05-07 2015-05-08 2015-05-09 2015-05-11 2015-05-12 2015-05-14 
         3          2          1          3          4          1          2 
2015-05-15 2015-05-16 2015-05-19 2015-05-20 2015-05-21 2015-05-24 2015-05-28 
         2          1          1          2          1          1          1 
2015-05-30 2015-06-05 2015-06-13 2015-07-11 2016-04-27 2016-04-29 2016-05-01 
         1          1          1          1          1          1          1 
2016-05-04 2016-05-05 2016-05-06 2016-05-08 2016-05-11 2016-05-12 2016-05-13 
         1          2          1          1          2          3          2 
2016-05-14 2016-05-16 2016-05-18 2016-05-19 2016-05-22 2016-05-25 2016-05-26 
         2          1          1          1          1          3          1 
2016-05-28 2016-05-29 2016-06-02 2016-06-04 2016-06-16 2016-06-18 2017-04-28 
         1          1          1          1          1          2          1 
2017-04-30 2017-05-03 2017-05-04 2017-05-06 2017-05-07 2017-05-08 2017-05-10 
         2          1          1          1          2          1          2 
2017-05-11 2017-05-12 2017-05-13 2017-05-19 2017-05-21 2017-05-24 2017-05-26 
         2          3          1          3          1          1          1 
2017-05-28 2017-05-31 2017-06-02 2017-06-03 2017-06-04 2017-06-14 2018-05-03 
         1          1          2          1          1          1          1 
2018-05-04 2018-05-06 2018-05-10 2018-05-11 2018-05-12 2018-05-14 2018-05-16 
         1          2          2          2          2          2          3 
2018-05-17 2018-05-18 2018-05-19 2018-05-20 2018-05-23 2018-05-29 2018-05-30 
         2          1          1          2          1          1          2 
2018-05-31 2018-06-01 2018-06-02 2018-06-15 2019-05-03 2019-05-04 2019-05-05 
         3          1          1          1          1          1          1 
2019-05-09 2019-05-10 2019-05-11 2019-05-14 2019-05-16 2019-05-17 2019-05-22 
         4          3          5          1          1          1          1 
2019-05-23 2019-05-24 2019-05-25 2019-06-01 2019-06-02 2019-06-05 2019-06-06 
         1          1          2          1          1          1          2 
2019-06-12 2019-07-06 2020-05-07 2020-05-10 2020-05-11 2020-05-13 2020-05-14 
         1          1          1          1          1          2          2 
2020-05-15 2020-05-16 2020-05-17 2020-05-19 2020-05-20 2020-05-21 2020-05-22 
         3          1          1          1          1          2          3 
2020-05-23 2020-05-24 2020-05-28 2020-05-29 2020-05-30 2020-06-03 2020-06-11 
         1          1          1          2          2          1          1 
2020-06-12 2020-06-27 2020-07-03 2021-05-05 2021-05-06 2021-05-08 2021-05-09 
         1          1          1          2          1          1          2 
2021-05-10 2021-05-12 2021-05-13 2021-05-14 2021-05-17 2021-05-19 2021-05-20 
         1          2          1          3          1          4          2 
2021-05-21 2021-05-25 2021-05-27 2021-05-28 2021-05-30 2021-06-02 2021-06-04 
         1          1          1          1          1          2          2 
2021-06-17 2022-05-06 2022-05-07 2022-05-08 2022-05-09 2022-05-11 2022-05-14 
         1          1          1          3          1          1          1 
2022-05-15 2022-05-16 2022-05-17 2022-05-18 2022-05-19 2022-05-20 2022-05-21 
         1          1          1          1          2          2          3 
2022-05-25 2022-05-26 2022-05-27 2022-05-29 2022-06-03 2022-06-08 2022-06-11 
         1          1          1          2          2          1          1 
2022-06-25 2022-06-27 2022-07-01 2023-05-07 2023-05-10 2023-05-11 2023-05-12 
         1          1          1          2          1          1          2 
2023-05-13 2023-05-14 2023-05-16 2023-05-19 2023-05-21 2023-05-24 2023-05-26 
         1          3          2          1          1          2          1 
2023-05-28 2023-05-30 2023-06-01 2023-06-02 2023-06-03 2023-06-07 2023-06-09 
         1          1          2          2          1          2          1 
2023-06-10 2023-06-17 2023-07-23 
         1          1          1 

$first_chick

           2000-05-28 2000-05-31 2000-06-01 2000-06-02 2000-06-03 2000-06-04 
       262          1          1          1          2          3          1 
2000-06-06 2000-06-07 2000-06-08 2000-06-09 2000-06-18 2000-06-20 2000-06-22 
         1          1          1          1          1          2          1 
2000-06-24 2000-06-26 2000-06-28 2000-07-22 2004-05-31 2004-06-04 2004-06-05 
         1          1          1          1          2          2          1 
2004-06-06 2004-06-09 2004-06-11 2004-06-14 2004-06-16 2004-06-18 2004-06-20 
         1          1          2          1          1          1          1 
2004-06-21 2004-06-22 2004-06-27 2004-07-04 2004-07-18 2005-05-27 2005-05-28 
         1          2          1          1          1          1          1 
2005-06-01 2005-06-02 2005-06-03 2005-06-05 2005-06-06 2005-06-09 2005-06-10 
         2          3          1          1          1          1          4 
2005-06-11 2005-06-12 2005-06-15 2005-06-26 2005-07-01 2005-07-21 2006-06-02 
         1          1          1          2          1          1          1 
2006-06-03 2006-06-05 2006-06-07 2006-06-09 2006-06-10 2006-06-11 2006-06-13 
         1          1          1          1          1          1          1 
2006-06-14 2006-06-16 2006-06-17 2006-06-20 2006-06-24 2006-06-30 2006-07-03 
         2          2          2          1          2          1          1 
2006-07-14 2007-06-06 2007-06-07 2007-06-09 2007-06-10 2007-06-11 2007-06-12 
         1          2          2          1          3          1          2 
2007-06-13 2007-06-14 2007-06-15 2007-06-20 2007-06-27 2007-06-28 2007-06-29 
         1          2          3          3          1          1          1 
2007-07-02 2007-07-15 2007-07-19 2008-05-30 2008-06-02 2008-06-04 2008-06-05 
         1          1          1          1          1          2          4 
2008-06-07 2008-06-08 2008-06-09 2008-06-12 2008-06-17 2008-06-18 2008-06-25 
         1          2          1          2          1          1          1 
2008-06-26 2008-06-27 2008-06-29 2008-07-06 2008-07-10 2009-05-27 2009-05-28 
         2          1          1          1          1          1          2 
2009-05-29 2009-05-30 2009-05-31 2009-06-03 2009-06-04 2009-06-05 2009-06-06 
         1          1          2          1          4          1          3 
2009-06-10 2009-06-11 2009-06-17 2009-06-20 2009-06-24 2009-06-25 2009-06-26 
         1          1          1          1          1          1          1 
2009-06-29 2009-07-15 2010-05-25 2010-05-26 2010-05-27 2010-05-30 2010-06-01 
         1          1          1          2          3          3          1 
2010-06-03 2010-06-04 2010-06-09 2010-06-10 2010-06-11 2010-06-16 2010-06-17 
         3          1          1          2          1          2          1 
2010-06-18 2010-06-25 2010-06-30 2010-07-01 2010-07-02 2010-07-07 2010-07-09 
         1          1          2          1          1          1          1 
2011-05-25 2011-05-26 2011-05-27 2011-05-29 2011-05-31 2011-06-02 2011-06-03 
         1          1          1          1          1          2          1 
2011-06-04 2011-06-05 2011-06-06 2011-06-08 2011-06-09 2011-06-10 2011-06-11 
         1          1          1          2          1          1          1 
2011-06-12 2011-06-14 2011-06-16 2011-06-17 2011-06-18 2011-06-30 2011-07-01 
         1          1          1          1          1          1          1 
2011-07-10 2011-07-13 2011-07-21 2012-05-20 2012-05-23 2012-05-24 2012-05-26 
         1          1          1          1          1          1          1 
2012-05-27 2012-05-28 2012-05-31 2012-06-01 2012-06-02 2012-06-04 2012-06-06 
         1          2          1          2          1          1          3 
2012-06-08 2012-06-10 2012-06-15 2012-06-20 2012-06-23 2012-06-24 2012-07-01 
         1          1          2          1          3          1          1 
2013-05-11 2013-05-26 2013-05-27 2013-05-29 2013-05-31 2013-06-01 2013-06-03 
         1          3          1          1          1          1          1 
2013-06-06 2013-06-07 2013-06-08 2013-06-09 2013-06-12 2013-06-13 2013-06-19 
         2          3          1          2          1          1          1 
2013-06-21 2013-06-22 2013-06-23 2013-06-26 2013-06-29 2014-05-22 2014-05-24 
         1          1          1          1          1          1          1 
2014-05-25 2014-05-29 2014-05-31 2014-06-01 2014-06-02 2014-06-03 2014-06-05 
         1          2          2          2          1          1          3 
2014-06-06 2014-06-09 2014-06-11 2014-06-13 2014-06-14 2014-06-15 2014-06-19 
         2          1          1          1          2          1          1 
2014-06-20 2014-06-21 2014-06-29 2014-07-02 2014-07-26 2014-08-01 2015-05-22 
         1          1          1          1          1          1          1 
2015-05-25 2015-05-26 2015-05-28 2015-05-29 2015-05-30 2015-05-31 2015-06-04 
         1          1          2          1          1          2          6 
2015-06-05 2015-06-06 2015-06-08 2015-06-10 2015-06-11 2015-06-12 2015-06-19 
         1          1          1          1          1          1          1 
2015-06-26 2015-06-27 2015-08-02 2016-05-22 2016-05-25 2016-05-26 2016-05-27 
         1          1          1          1          1          2          1 
2016-05-28 2016-05-29 2016-06-02 2016-06-04 2016-06-05 2016-06-06 2016-06-08 
         2          3          1          1          1          1          5 
2016-06-09 2016-06-10 2016-06-12 2016-06-16 2016-06-17 2016-06-18 2016-07-13 
         1          1          2          2          1          1          1 
2016-07-14 2016-07-15 2016-07-16 2017-05-22 2017-05-25 2017-05-26 2017-05-28 
         1          1          1          1          3          1          3 
2017-05-30 2017-06-01 2017-06-02 2017-06-03 2017-06-08 2017-06-11 2017-06-12 
         1          3          3          1          1          1          1 
2017-06-14 2017-06-16 2017-06-17 2017-06-21 2017-06-22 2017-06-24 2018-05-27 
         2          1          1          2          1          1          1 
2018-05-30 2018-05-31 2018-06-02 2018-06-03 2018-06-04 2018-06-05 2018-06-07 
         1          3          1          1          1          1          4 
2018-06-08 2018-06-10 2018-06-13 2018-06-14 2018-06-18 2018-06-20 2018-06-23 
         2          2          1          1          1          1          1 
2018-06-25 2018-06-28 2018-07-13 2019-05-30 2019-05-31 2019-06-02 2019-06-03 
         1          1          1          2          2          1          2 
2019-06-04 2019-06-05 2019-06-06 2019-06-07 2019-06-09 2019-06-16 2019-06-18 
         1          1          1          1          1          3          1 
2019-06-20 2019-06-23 2019-06-26 2019-06-27 2019-06-30 2019-07-02 2019-07-03 
         1          1          2          2          1          1          2 
2019-07-04 2020-05-31 2020-06-01 2020-06-03 2020-06-04 2020-06-05 2020-06-07 
         1          1          1          1          3          1          1 
2020-06-12 2020-06-13 2020-06-14 2020-06-19 2020-06-20 2020-06-21 2020-06-23 
         2          1          2          2          1          2          1 
2020-06-27 2020-07-02 2020-07-03 2020-07-05 2020-07-09 2020-07-16 2020-07-20 
         1          1          2          2          1          1          1 
2020-07-30 2021-05-28 2021-05-30 2021-05-31 2021-06-03 2021-06-04 2021-06-05 
         1          1          1          2          3          1          1 
2021-06-06 2021-06-07 2021-06-11 2021-06-12 2021-06-14 2021-06-16 2021-06-18 
         1          1          2          2          1          1          1 
2021-06-27 2021-06-30 2021-07-01 2021-07-02 2021-07-15 2022-05-27 2022-06-02 
         2          1          2          1          1          1          5 
2022-06-03 2022-06-04 2022-06-06 2022-06-08 2022-06-11 2022-06-12 2022-06-13 
         1          1          1          1          1          2          1 
2022-06-15 2022-06-16 2022-06-17 2022-06-19 2022-06-20 2022-06-22 2022-06-23 
         1          1          3          1          1          1          2 
2022-06-25 2023-05-28 2023-05-31 2023-06-01 2023-06-04 2023-06-05 2023-06-09 
         1          1          1          1          1          4          1 
2023-06-10 2023-06-14 2023-06-17 2023-06-18 2023-06-19 2023-06-23 2023-06-25 
         2          2          1          1          1          1          1 
2023-06-29 2023-07-05 2023-07-09 2023-07-27 2023-08-02 2023-08-04 3000-06-02 
         1          1          1          1          1          1          1 

$first_fledge

           2000-06-20 2000-06-21 2000-06-22 2000-06-24 2000-06-25 2000-06-26 
       387          1          1          2          3          2          2 
2000-06-30 2000-07-04 2000-07-08 2000-07-13 2000-07-15 2000-07-16 2000-07-17 
         2          1          1          1          1          1          1 
2000-07-20 2000-07-24 2000-08-06 2004-06-23 2004-06-25 2004-06-26 2004-06-30 
         1          1          1          1          1          1          1 
2004-07-02 2004-07-04 2004-07-10 2004-07-13 2004-07-14 2004-07-17 2004-07-18 
         1          2          1          1          2          1          1 
2004-07-25 2005-06-22 2005-06-23 2005-06-24 2005-06-25 2005-06-30 2005-07-01 
         1          3          1          2          3          1          1 
2005-07-02 2005-07-07 2005-07-08 2005-07-13 2005-07-18 2005-07-20 2005-07-22 
         1          1          1          1          1          1          1 
2005-08-27 2006-06-23 2006-06-25 2006-06-29 2006-06-30 2006-07-01 2006-07-04 
         1          1          1          1          1          1          2 
2006-07-07 2006-07-12 2006-07-13 2006-07-15 2006-07-17 2006-07-24 2006-07-28 
         3          1          1          2          1          1          1 
2006-08-02 2006-08-11 2007-06-26 2007-06-27 2007-06-28 2007-06-29 2007-06-30 
         1          1          1          1          2          1          1 
2007-07-02 2007-07-04 2007-07-05 2007-07-06 2007-07-10 2007-07-11 2007-07-12 
         2          3          1          1          1          2          2 
2007-07-13 2007-07-18 2007-07-23 2007-08-08 2008-06-20 2008-06-22 2008-06-25 
         2          2          1          2          1          1          2 
2008-06-26 2008-06-27 2008-06-28 2008-06-29 2008-07-02 2008-07-15 2008-07-17 
         3          1          2          1          1          1          1 
2008-07-18 2008-07-20 2008-07-24 2008-07-30 2008-07-31 2008-08-17 2009-06-16 
         1          2          1          1          1          1          1 
2009-06-20 2009-06-21 2009-06-24 2009-06-25 2009-06-26 2009-06-29 2009-06-30 
         2          1          3          3          1          1          1 
2009-07-01 2009-07-03 2009-07-05 2009-07-10 2009-07-15 2009-07-16 2009-07-20 
         1          1          1          1          2          1          1 
2009-08-07 2010-06-09 2010-06-16 2010-06-17 2010-06-18 2010-06-20 2010-06-22 
         1          1          1          2          3          2          1 
2010-06-24 2010-06-25 2010-06-27 2010-06-30 2010-07-01 2010-07-09 2010-07-14 
         1          2          1          1          1          2          2 
2010-07-21 2010-07-23 2010-07-27 2010-07-29 2010-07-30 2010-08-05 2011-06-14 
         1          1          1          1          1          1          1 
2011-06-17 2011-06-19 2011-06-22 2011-06-23 2011-06-25 2011-06-27 2011-06-28 
         1          1          1          4          2          1          1 
2011-07-01 2011-07-03 2011-07-06 2011-07-09 2011-07-11 2011-07-21 2011-07-22 
         3          1          1          1          1          1          1 
2011-07-24 2012-06-15 2012-06-17 2012-06-19 2012-06-21 2012-06-22 2012-06-23 
         1          1          2          1          1          1          1 
2012-06-24 2012-06-26 2012-06-27 2012-06-28 2012-06-29 2012-07-01 2012-07-03 
         1          1          1          1          1          1          1 
2012-07-07 2012-07-14 2012-07-15 2012-07-19 2012-07-21 2012-08-17 2013-06-20 
         1          1          1          1          1          1          1 
2013-06-21 2013-06-22 2013-06-23 2013-06-26 2013-06-27 2013-06-29 2013-06-30 
         1          2          1          1          2          2          1 
2013-07-02 2013-07-04 2013-07-05 2013-07-10 2013-07-11 2013-07-17 2013-07-20 
         1          1          1          2          1          1          1 
2013-07-31 2013-08-02 2014-06-15 2014-06-16 2014-06-18 2014-06-19 2014-06-21 
         1          1          1          2          1          3          1 
2014-06-22 2014-06-23 2014-06-27 2014-06-28 2014-07-03 2014-07-04 2014-07-05 
         2          1          3          1          1          2          2 
2014-07-09 2014-07-12 2014-07-16 2014-08-09 2014-08-15 2015-06-13 2015-06-14 
         1          1          1          1          1          1          3 
2015-06-17 2015-06-18 2015-06-20 2015-06-22 2015-06-25 2015-06-26 2015-06-27 
         1          1          1          1          2          3          1 
2015-06-30 2015-07-02 2015-07-03 2015-07-04 2015-07-17 2015-08-19 2016-06-09 
         1          1          2          1          1          1          1 
2016-06-14 2016-06-15 2016-06-17 2016-06-19 2016-06-23 2016-06-24 2016-06-27 
         1          1          1          3          4          1          1 
2016-06-29 2016-07-02 2016-07-03 2016-07-06 2016-07-07 2016-07-08 2016-07-09 
         2          3          3          2          2          2          1 
2016-08-05 2017-06-11 2017-06-15 2017-06-17 2017-06-18 2017-06-20 2017-06-21 
         1          2          1          1          1          1          1 
2017-06-22 2017-06-23 2017-06-24 2017-06-27 2017-06-29 2017-07-02 2017-07-05 
         3          1          1          2          1          1          1 
2017-07-06 2017-07-07 2017-07-11 2017-07-12 2017-07-14 2017-07-25 2017-08-05 
         1          1          1          1          1          1          1 
2018-06-21 2018-06-22 2018-06-23 2018-06-24 2018-06-26 2018-06-27 2018-06-28 
         2          1          2          2          1          2          3 
2018-06-29 2018-07-04 2018-07-05 2018-07-06 2018-07-12 2018-07-14 2018-07-19 
         1          2          1          1          1          1          1 
2018-08-03 2019-06-19 2019-06-20 2019-06-21 2019-06-23 2019-06-26 2019-06-27 
         1          1          1          1          1          1          2 
2019-06-28 2019-06-29 2019-06-30 2019-07-01 2019-07-03 2019-07-04 2019-07-07 
         1          1          1          1          1          1          1 
2019-07-08 2019-07-10 2019-07-12 2019-07-13 2019-07-18 2019-07-19 2019-07-20 
         1          1          2          1          1          1          1 
2019-07-21 2019-08-01 2020-06-20 2020-06-24 2020-06-25 2020-07-02 2020-07-03 
         3          1          1          2          3          1          1 
2020-07-04 2020-07-08 2020-07-09 2020-07-13 2020-07-14 2020-07-15 2020-07-17 
         1          1          3          1          1          2          2 
2020-07-24 2020-07-26 2020-08-06 2020-08-13 2020-08-23 2022-06-25 
         1          2          1          1          1          1 
```


:::
:::


We use `map` rather than one of the other map functions for this step because
the table for each column will have a different length.
-->
<p>The <a href="https://purrr.tidyverse.org/">purrr documentation</a> provides more details about how to use the many functions in the package.</p>
</section>
</section>
<section id="sec-for-loops" class="level2" data-number="26.5">
<h2 data-number="26.5" class="anchored" data-anchor-id="sec-for-loops"><span class="header-section-number">26.5</span> For Loops</h2>
<p>A <strong>for loop</strong> runs the code in its body once for each element of a data structure. <a href="#fig-for-loop" class="quarto-xref">Figure&nbsp;<span>26.3</span></a> shows what for loop looks like in a flowchart.</p>
<p>In most programming languages, the keyword <code>for</code> creates a for loop. In R, the syntax of a for loop is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (element <span class="cf">in</span> data) {</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs once for each element in data.</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The loop automatically assigns the next element of <code>data</code> to the variable <code>element</code> at the beginning of each iteration. The loop iterates once for each element, unless a keyword causes the loop to end early.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For loops and map functions do almost the same thing. Here’s how the for loop syntax above translates into a map function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">map</span>(data, \(element) {</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs once for each element in data.</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Map functions tend to be easier to use because they automatically return the result from each iteration. For loops don’t, and leave it up to you to figure out how to store the results.</p>
<p>The limitation of map functions is that the each iteration must be independent. You can’t have an iteration that depends on the result of a prior iteration. For loops don’t have this limitation. Dependent iterations are common in simulations, but not so common in data cleaning and analysis tasks.</p>
</div>
</div>
<p>As a demonstration, let’s print out a message with the current iteration number for 5 iterations:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(<span class="st">"Hi from iteration "</span>, i)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>Hi from iteration 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Hi from iteration 2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Hi from iteration 3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Hi from iteration 4</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Hi from iteration 5</code></pre>
</div>
</div>
<p>Unlike map functions, loops don’t return a result automatically. It’s up to you to use variables to store any results you want to use later. To do this:</p>
<ol type="1">
<li>Before the loop, create a result vector (or list) that’s the same length as the number of iterations. Fill vector with 0s or some other placeholder value. You can use functions such as <code>integer</code>, <code>numeric</code>, and <code>character</code> to do this.</li>
<li>In the loop, use indexing to replace the elements of the result vector as they’re computed.</li>
</ol>
<p>This approach to storing results is called <strong>pre-allocation</strong>. Here’s an example of pre-allocation for a loop that computes what happens if you repeatedly call the sine function on a value:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of iterations:</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">99</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a numeric vector with n elements and set the first element to 1.</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>result <span class="ot">=</span> <span class="fu">numeric</span>(n)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>result[<span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the result from the previous iteration.</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is why this loop starts at i = 2.</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  prev_result <span class="ot">=</span> result[i <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the sine of the previous result.</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save it into the results vector at position i.</span></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  result[i] <span class="ot">=</span> <span class="fu">sin</span>(prev_result)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Plotting the result vector makes it easier to see the pattern in the values:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>result_df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span>n, <span class="at">y =</span> result)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(result_df) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="control-flow_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>break</code> keyword causes a for loop to immediately exit. It only makes sense to use <code>break</code> inside of a conditional (otherwise, the loop will exit in the first iteration).</p>
<p>The <code>next</code> keyword causes a for loop to immediately go to the next iteration. As with <code>break</code>, it only makes sense to use <code>next</code> inside of a conditional.</p>
<p>You can also use <code>break</code> and <code>next</code> in while loops.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Note: While Loops">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Note: While Loops
</div>
</div>
<div class="callout-body-container callout-body">
<p>A <strong>while loop</strong> makes the computer check a condition at the beginning of each iteration to decide whether to run the code in the loop’s body. <a href="#fig-while-loop" class="quarto-xref">Figure&nbsp;<span>26.2</span></a> shows what a while loop looks like in a flowchart.</p>
<p>In most programming languages, the keyword <code>while</code> creates a while loop. In R, the syntax of a while loop is:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (condition) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This code runs repeatedly until the condition is FALSE.</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>While loops are a generalization of for loops, and only do the bare minimum necessary to iterate. They tend to be most useful when you don’t know how many iterations are necessary to complete a task.</p>
</div>
</div>
</section>
<section id="sec-how-to-write-loop" class="level2" data-number="26.6">
<h2 data-number="26.6" class="anchored" data-anchor-id="sec-how-to-write-loop"><span class="header-section-number">26.6</span> How to Write a Loop</h2>
<p>Before you write a loop, write down what you want the code to do. Think about whether the code needs to do something over and over. If it doesn’t, you probably shouldn’t use a loop. Do this in comments, in a separate document, or even on paper.</p>
<p>Once you’ve finished writing out and clarifying the goal, it’s time to write the code. Go through these steps:</p>
<ol type="1">
<li><p>Write the code for one iteration. Don’t worry about putting the code in a loop yet. Make sure that the result is correct. Sometimes the best way to approach this is by writing a function (see <a href="writing-functions.html#sec-how-to-write-function" class="quarto-xref"><span>Section 25.3</span></a>).</p></li>
<li><p>Make a copy of the code from step 1 and edit it to run a different iteration. Pay attention to what you have to change. Once again, make sure that the result is correct.</p></li>
<li><p>Once you’ve got the code working for two iterations, make another copy and wrap it in a loop. The parts of the code that had to change in step 2 are a hint about what will change in every iteration. Replace changing data with the loop’s automatic variable. Put code that should only run on some of the iterations in conditionals.</p></li>
<li><p>Test that the loop code works correctly. If it doesn’t, try to pinpoint which iteration is causing the problem. One way to do this is to use <code>message</code> to print out information. Then write out the code for just the broken iteration, get it working, and repeat this process from step 3.</p></li>
</ol>
<p>To decide what kind of loop to use, go down this list:</p>
<ol type="1">
<li>Vectorization</li>
<li>Map (or apply) functions
<ul>
<li>Try an apply function if iterations are independent.</li>
</ul></li>
<li>For and while loops
<ul>
<li>Try a for-loop if some iterations depend on others.</li>
<li>Try a while-loop if the number of iterations is unknown.</li>
</ul></li>
<li>Recursion
<ul>
<li>Convenient for naturally recursive tasks (like Fibonacci), but often there are faster solutions.</li>
</ul></li>
</ol>
<p>The list items are organized from fastest to slowest, although the speed difference between map functions and for loops is negligible.</p>
<p>Vectorization is the most efficient and concise, but only works with specific functions on vectors. Map functions work with any function and any data structure with elements, while still returning the results automatically. For and while loops provide the most flexibility, but leave it up to you to save the results. Recursion works well for specific kinds of problems, but can be confusing and is the slowest kind of loop in R.</p>
</section>
<section id="sec-case-study-fuel-3" class="level2" data-number="26.7">
<h2 data-number="26.7" class="anchored" data-anchor-id="sec-case-study-fuel-3"><span class="header-section-number">26.7</span> Case Study: U.S. Alternative Fueling Stations, Part III</h2>
<p>Let’s finish the U.S. Alternative Fueling Stations case study we began in <a href="writing-functions.html#sec-case-study-fuel-1" class="quarto-xref"><span>Section 25.5</span></a> and continued in <a href="#sec-case-study-fuel-2" class="quarto-xref"><span>Section 26.2</span></a>. In the previous part, we modified the <code>read_fuel_sheet</code> function so that it can read and clean sheets for any year in the dataset Excel file:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>read_fuel_sheet <span class="ot">=</span> <span class="cf">function</span>(path, year) {</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">as.character</span>(year)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> sheet, <span class="at">skip =</span> <span class="dv">1</span>)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean up the column names.</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">names</span>(stations)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&lt;</span> <span class="dv">2014</span>) {</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    is_dot_name <span class="ot">=</span> <span class="fu">str_starts</span>(names, <span class="fu">fixed</span>(<span class="st">"..."</span>))</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    names[is_dot_name] <span class="ot">=</span> <span class="fu">as.character</span>(stations[<span class="dv">2</span>, is_dot_name])</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">str_to_lower</span>(names)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  names <span class="ot">=</span> <span class="fu">str_replace_all</span>(names, <span class="fu">fixed</span>(<span class="st">" "</span>), <span class="st">"_"</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(stations) <span class="ot">=</span> names</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&gt;=</span> <span class="dv">2014</span>) {</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>    stations <span class="ot">=</span> <span class="fu">rename</span>(</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>      stations,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">electric =</span> electrica,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">hydrogen =</span> hydrogenb,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">propane =</span> propanec,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">total =</span> totald</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove blank rows.</span></span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  stations <span class="ot">=</span> <span class="fu">filter</span>(stations, <span class="sc">!</span><span class="fu">is.na</span>(biodiesel))</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct column types and add year column.</span></span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&gt;=</span> <span class="dv">2014</span>) {</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>    electric <span class="ot">=</span> <span class="fu">str_replace_all</span>(stations<span class="sc">$</span>electric, <span class="fu">fixed</span>(<span class="st">","</span>), <span class="st">""</span>)</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>    electric <span class="ot">=</span> <span class="fu">str_split_fixed</span>(electric, <span class="fu">fixed</span>(<span class="st">" | "</span>), <span class="dv">2</span>)</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">1</span>])</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>    stations<span class="sc">$</span>electric_outlets <span class="ot">=</span> <span class="fu">as.numeric</span>(electric[, <span class="dv">2</span>])</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: hydrogen, propane</span></span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  stations<span class="sc">$</span>electric <span class="ot">=</span> <span class="fu">as.numeric</span>(stations<span class="sc">$</span>electric)</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span><span class="al">TODO</span><span class="co">: hydrogen, propane</span></span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  stations<span class="sc">$</span>year <span class="ot">=</span> year</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  stations</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>In this part, let’s use the function to read all of the sheets, then combine them into a single data frame and make a plot of number of electric stations over time. Imagine what it would look like if we wrote out the code to read the data for each year separately:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"data/2007-2023_us_alt_fuels.xlsx"</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">read_fuel_sheet</span>(path, <span class="dv">2007</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">read_fuel_sheet</span>(path, <span class="dv">2008</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">read_fuel_sheet</span>(path, <span class="dv">2023</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The year is what differs between the calls, so we need to iterate over the years. We could create a vector of years with <code>2007:2023</code>. Instead, let’s use readxl’s <code>excel_sheets</code> function to get the sheet names, which correspond to years, and convert them to numbers:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>years <span class="ot">=</span> <span class="fu">excel_sheets</span>(path)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Skip the first sheet (which is documentation) and convert to numbers.</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>years <span class="ot">=</span> <span class="fu">as.numeric</span>(years[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>years</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 2023 2022 2021 2020 2019 2018 2017 2016 2015 2014 2013 2012 2011 2010 2009
[16] 2008 2007</code></pre>
</div>
</div>
<p>Now we need to call the <code>read_fuel_sheet</code> function with each year in the <code>years</code> vector. We can use purrr’s <code>map</code> function to do this. Since the year should be the second argument to <code>read_fuel_sheet</code>, we have to write the call out explicitly (alternatively, we could modify <code>read_fuel_sheet</code> so that the year is the first argument):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>sheets <span class="ot">=</span> <span class="fu">map</span>(years, \(year) {</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_fuel_sheet</span>(path, year)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>This gives a list of data frames, one for each year. We want to bind them into a single data frame, stacking the rows of each one atop the next. We can use dplyr’s <code>bind_rows</code> function to do this:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>stations <span class="ot">=</span> <span class="fu">bind_rows</span>(sheets)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(stations)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 12
  state   biodiesel   cng   e85 electric hydrogen   lng propane renewable_diesel
  &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;              &lt;dbl&gt;
1 Alabama         9    28    34      424 0 | 0 |…     2 25 | 3…                0
2 Alaska          0     0     0       65 0 | 0 |…     0 1 | 0 …                0
3 Arizona        77    26    21     1198 0 | 0 |…     5 42 | 3…                0
4 Arkans…        34    14    74      334 0 | 0 |…     0 17 | 1…                0
5 Califo…        48   292   369    16381 57 | 7 …    39 136 | …              597
6 Colora…         5    25    95     2165 0 | 1 |…     1 28 | 2…                0
# ℹ 3 more variables: total &lt;dbl&gt;, electric_outlets &lt;dbl&gt;, year &lt;dbl&gt;</code></pre>
</div>
</div>
<p>With the data in good shape, we’re ready to make a plot. Let’s make a line plot with the year on the x-axis, the number of electric stations on the y-axis, and the lines color-coded by state:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stations) <span class="sc">+</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> electric, <span class="at">color =</span> state)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="control-flow_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This plot is a bit hard to read because there are so many states. Let’s use dplyr’s <code>filter</code> function to focus only on states on the west coast:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>west <span class="ot">=</span> <span class="fu">filter</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  stations,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  state <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"California"</span>, <span class="st">"Oregon"</span>, <span class="st">"Washington"</span>, <span class="st">"Alaska"</span>, <span class="st">"Hawaii"</span>)</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(west) <span class="sc">+</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> electric, <span class="at">color =</span> state)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="control-flow_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now we can see that California has substantially more electric stations than the other west coast states. This could be due to its larger population or due to increased funding for alternative fueling stations.</p>
</section>
<section id="case-study-ca-hospital-utilization" class="level2" data-number="26.8">
<h2 data-number="26.8" class="anchored" data-anchor-id="case-study-ca-hospital-utilization"><span class="header-section-number">26.8</span> Case Study: CA Hospital Utilization</h2>
<p>The California Department of Health Care Access and Information (HCAI) requires hospitals in the state to submit detailed information each year about how many beds they have and the total number of days for which each bed was occupied. The HCAI publishes the data to the <a href="https://data.ca.gov/">California Open Data Portal</a>. Let’s use R to read data from 2016 to 2023 and investigate whether hospital utilization is noticeably different in and after 2020.</p>
<p>The dataset consists of a separate Microsoft Excel file for each year. Before 2018, HCAI used a data format (in Excel) called ALIRTS. In 2018, they started collecting more data and switched to a data format called SIERA. The 2018 data file contains a <strong>crosswalk</strong> that shows the correspondence between SIERA columns and ALIRTS columns.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p><a href="https://ucdavis.box.com/s/g5tanw22647dw3uyhv3om0zt3duuj5lc">Click here</a> to download the CA Hospital Utilization dataset (8 Excel files).</p>
<p>If you haven’t already, we recommend you create a directory for this workshop. In your workshop directory, create a <code>data/ca_hospitals</code> subdirectory. Download and save the dataset in the <code>data/ca_hospitals</code> subdirectory.</p>
</div>
</div>
<p>When you need to solve a programming problem, get started by writing some comments that describe the problem, the inputs, and the expected output. Try to be concrete. This will help you clarify what you’re trying to achieve and serve as a guiding light while you work.</p>
<p>As a programmer (or any kind of problem-solver), you should always be on the lookout for ways to break problems into smaller, simpler steps. Think about this when you frame a problem. Small steps are easier to reason about, implement, and test. When you complete one, you also get a nice sense of progress towards your goal.</p>
<p>For the CA Hospital Utilization dataset, our goal is to investigate whether there was a change in hospital utilization in 2020. Before we can do any investigation, we need to read the files into R. The files all contain tabular data and have similar formats, so let’s try to combine them into a single data frame. We’ll say this in the framing comments:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the CA Hospital Utilization dataset into R. The inputs are yearly Excel</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># files (2016-2023) that need to be combined. The pre-2018 files have a</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># different format from the others. The result should be a single data frame</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with information about bed and patient counts.</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co"># After reading the dataset, we'll investigate utilization in 2020.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>“Investigate utilization” is a little vague, but for an exploratory data analysis, it’s hard to say exactly what to do until you’ve started working with the data.</p>
<p>We need to read multiple files, but we can simplify the problem by starting with just one. Let’s start with the 2023 data. It’s in an Excel file, which you can read with the <code>read_excel</code> function from the readxl package. If it’s your first time using the readxl package, you’ll need to install it:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"readxl"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The <code>read_excel</code> function requires the path to the file as the first argument. You can optionally provide the sheet name or number (starting from 1) as the second argument. Open up the Excel file in your computer’s spreadsheet program and take a look. There are multiple sheets, and the data about beds and patients are in the second sheet. Back in R, read just the second sheet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"readxl"</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"data/ca_hospitals/hosp23_util_data_final.xlsx"</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>sheet <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...355`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sheet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 355
  Description            FAC_NO FAC_NAME FAC_STR_ADDR FAC_CITY FAC_ZIP FAC_PHONE
  &lt;chr&gt;                  &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    
1 FINAL 2023 UTILIZATIO… FINAL… FINAL 2… FINAL 2023 … FINAL 2… FINAL … FINAL 20…
2 Page                   1.0    1.0      1.0          1.0      1.0     1.0      
3 Column                 1.0    1.0      1.0          1.0      1.0     1.0      
4 Line                   2.0    1.0      3.0          4.0      5.0     6.0      
5 &lt;NA&gt;                   10601… ALAMEDA… 2070 CLINTO… ALAMEDA  94501   51023337…
6 &lt;NA&gt;                   10601… ALTA BA… 2450 ASHBY … BERKELEY 94705   510-655-…
# ℹ 348 more variables: FAC_ADMIN_NAME &lt;chr&gt;, FAC_OPERATED_THIS_YR &lt;chr&gt;,
#   FAC_OP_PER_BEGIN_DT &lt;chr&gt;, FAC_OP_PER_END_DT &lt;chr&gt;,
#   FAC_PAR_CORP_NAME &lt;chr&gt;, FAC_PAR_CORP_BUS_ADDR &lt;chr&gt;,
#   FAC_PAR_CORP_CITY &lt;chr&gt;, FAC_PAR_CORP_STATE &lt;chr&gt;, FAC_PAR_CORP_ZIP &lt;chr&gt;,
#   REPT_PREP_NAME &lt;chr&gt;, SUBMITTED_DT &lt;chr&gt;, REV_REPT_PREP_NAME &lt;chr&gt;,
#   REVISED_DT &lt;chr&gt;, CORRECTED_DT &lt;chr&gt;, LICENSE_NO &lt;chr&gt;,
#   LICENSE_EFF_DATE &lt;chr&gt;, LICENSE_EXP_DATE &lt;chr&gt;, LICENSE_STATUS &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>The first four rows contain metadata about the columns. The first hospital, Alameda Hospital, is listed in the fifth row. So let’s remove the first four rows:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>sheet <span class="ot">=</span> sheet[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), ]</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sheet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 355
  Description FAC_NO    FAC_NAME         FAC_STR_ADDR FAC_CITY FAC_ZIP FAC_PHONE
  &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    
1 &lt;NA&gt;        106010735 ALAMEDA HOSPITAL 2070 CLINTO… ALAMEDA  94501   51023337…
2 &lt;NA&gt;        106010739 ALTA BATES SUMM… 2450 ASHBY … BERKELEY 94705   510-655-…
3 &lt;NA&gt;        106010776 UCSF BENIOFF CH… 747 52ND ST… OAKLAND  94609   510-428-…
4 &lt;NA&gt;        106010811 FAIRMONT HOSPIT… 15400 FOOTH… SAN LEA… 94578   51043748…
5 &lt;NA&gt;        106010844 ALTA BATES SUMM… 2001 DWIGHT… BERKELEY 94704   510-655-…
6 &lt;NA&gt;        106010846 HIGHLAND HOSPIT… 1411 EAST 3… OAKLAND  94602   51043748…
# ℹ 348 more variables: FAC_ADMIN_NAME &lt;chr&gt;, FAC_OPERATED_THIS_YR &lt;chr&gt;,
#   FAC_OP_PER_BEGIN_DT &lt;chr&gt;, FAC_OP_PER_END_DT &lt;chr&gt;,
#   FAC_PAR_CORP_NAME &lt;chr&gt;, FAC_PAR_CORP_BUS_ADDR &lt;chr&gt;,
#   FAC_PAR_CORP_CITY &lt;chr&gt;, FAC_PAR_CORP_STATE &lt;chr&gt;, FAC_PAR_CORP_ZIP &lt;chr&gt;,
#   REPT_PREP_NAME &lt;chr&gt;, SUBMITTED_DT &lt;chr&gt;, REV_REPT_PREP_NAME &lt;chr&gt;,
#   REVISED_DT &lt;chr&gt;, CORRECTED_DT &lt;chr&gt;, LICENSE_NO &lt;chr&gt;,
#   LICENSE_EFF_DATE &lt;chr&gt;, LICENSE_EXP_DATE &lt;chr&gt;, LICENSE_STATUS &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Some datasets also have metadata in the last rows, so let’s check for that here:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(sheet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 355
  Description FAC_NO    FAC_NAME         FAC_STR_ADDR FAC_CITY FAC_ZIP FAC_PHONE
  &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    
1 &lt;NA&gt;        106574010 SUTTER DAVIS HO… 2000 SUTTER… DAVIS    95616   (530) 75…
2 &lt;NA&gt;        106580996 ADVENTIST HEALT… 726 FOURTH … MARYSVI… 95901   530-751-…
3 &lt;NA&gt;        206100718 COMMUNITY SUBAC… 3003 NORTH … FRESNO   93703   559-459-…
4 &lt;NA&gt;        206274027 WESTLAND HOUSE   100 BARNET … MONTEREY 93940   83162453…
5 &lt;NA&gt;        206351814 HAZEL HAWKINS M… 900 SUNSET … HOLLIST… 95023   831-635-…
6 &lt;NA&gt;        &lt;NA&gt;      n = 506          &lt;NA&gt;         &lt;NA&gt;     &lt;NA&gt;    &lt;NA&gt;     
# ℹ 348 more variables: FAC_ADMIN_NAME &lt;chr&gt;, FAC_OPERATED_THIS_YR &lt;chr&gt;,
#   FAC_OP_PER_BEGIN_DT &lt;chr&gt;, FAC_OP_PER_END_DT &lt;chr&gt;,
#   FAC_PAR_CORP_NAME &lt;chr&gt;, FAC_PAR_CORP_BUS_ADDR &lt;chr&gt;,
#   FAC_PAR_CORP_CITY &lt;chr&gt;, FAC_PAR_CORP_STATE &lt;chr&gt;, FAC_PAR_CORP_ZIP &lt;chr&gt;,
#   REPT_PREP_NAME &lt;chr&gt;, SUBMITTED_DT &lt;chr&gt;, REV_REPT_PREP_NAME &lt;chr&gt;,
#   REVISED_DT &lt;chr&gt;, CORRECTED_DT &lt;chr&gt;, LICENSE_NO &lt;chr&gt;,
#   LICENSE_EFF_DATE &lt;chr&gt;, LICENSE_EXP_DATE &lt;chr&gt;, LICENSE_STATUS &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Sure enough, the last row contains what appears to be a count of the hospitals rather than a hospital. Let’s remove it by calling <code>head</code> with a negative number of elements, which removes that many elements from the end:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>sheet <span class="ot">=</span> <span class="fu">head</span>(sheet, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(sheet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 355
  Description FAC_NO    FAC_NAME         FAC_STR_ADDR FAC_CITY FAC_ZIP FAC_PHONE
  &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt;        &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;    
1 &lt;NA&gt;        106571086 WOODLAND MEMORI… 1325 COTTON… WOODLAND 95695   (530) 66…
2 &lt;NA&gt;        106574010 SUTTER DAVIS HO… 2000 SUTTER… DAVIS    95616   (530) 75…
3 &lt;NA&gt;        106580996 ADVENTIST HEALT… 726 FOURTH … MARYSVI… 95901   530-751-…
4 &lt;NA&gt;        206100718 COMMUNITY SUBAC… 3003 NORTH … FRESNO   93703   559-459-…
5 &lt;NA&gt;        206274027 WESTLAND HOUSE   100 BARNET … MONTEREY 93940   83162453…
6 &lt;NA&gt;        206351814 HAZEL HAWKINS M… 900 SUNSET … HOLLIST… 95023   831-635-…
# ℹ 348 more variables: FAC_ADMIN_NAME &lt;chr&gt;, FAC_OPERATED_THIS_YR &lt;chr&gt;,
#   FAC_OP_PER_BEGIN_DT &lt;chr&gt;, FAC_OP_PER_END_DT &lt;chr&gt;,
#   FAC_PAR_CORP_NAME &lt;chr&gt;, FAC_PAR_CORP_BUS_ADDR &lt;chr&gt;,
#   FAC_PAR_CORP_CITY &lt;chr&gt;, FAC_PAR_CORP_STATE &lt;chr&gt;, FAC_PAR_CORP_ZIP &lt;chr&gt;,
#   REPT_PREP_NAME &lt;chr&gt;, SUBMITTED_DT &lt;chr&gt;, REV_REPT_PREP_NAME &lt;chr&gt;,
#   REVISED_DT &lt;chr&gt;, CORRECTED_DT &lt;chr&gt;, LICENSE_NO &lt;chr&gt;,
#   LICENSE_EFF_DATE &lt;chr&gt;, LICENSE_EXP_DATE &lt;chr&gt;, LICENSE_STATUS &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>There are a lot of columns in sheet, so let’s make a list of just a few that we’ll use for analysis. We’ll keep:</p>
<ul>
<li>Columns with facility name, location, and operating status</li>
<li>All of the columns whose names start with <code>TOT</code>, because these are totals for number of beds, number of census-days, and so on.</li>
<li>Columns about acute respiratory beds, with names that contain <code>RESPIRATORY</code>, because they might also be relevant.</li>
</ul>
<p>We can use the stringr package, which provides string processing functions, to help us get the <code>TOT</code> and <code>RESPIRATORY</code> column names. If it’s your first time using the stringr package, you’ll have to install it:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"stringr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We can use stringr’s <code>str_starts</code> function to check whether column names start with <code>TOT</code> and its <code>str_detect</code> function to check whether column names contain <code>RESPIRATORY</code>:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"stringr"</span>)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>facility_cols <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FAC_NAME"</span>, <span class="st">"FAC_CITY"</span>, <span class="st">"FAC_ZIP"</span>, <span class="st">"FAC_OPERATED_THIS_YR"</span>, <span class="st">"FACILITY_LEVEL"</span>,</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"TEACH_HOSP"</span>, <span class="st">"COUNTY"</span>, <span class="st">"PRIN_SERVICE_TYPE"</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">=</span> <span class="fu">names</span>(sheet)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>tot_cols <span class="ot">=</span> cols[<span class="fu">str_starts</span>(cols, <span class="st">"TOT"</span>)]</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>respiratory_cols <span class="ot">=</span> cols[<span class="fu">str_detect</span>(cols, <span class="st">"RESPIRATORY"</span>)]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The <code>TOT</code> and <code>RESPIRATORY</code> columns all contain numbers, but the element type is <code>character</code>, so let’s cast to numbers them with <code>as.numeric</code>. We’ll also add a column with the year:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>numeric_cols <span class="ot">=</span> <span class="fu">c</span>(tot_cols, respiratory_cols)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>sheet[numeric_cols] <span class="ot">=</span> <span class="fu">lapply</span>(sheet[numeric_cols], as.numeric)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>sheet<span class="sc">$</span>year <span class="ot">=</span> <span class="dv">2023</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now we’ll select only the columns we identified as useful:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>sheet <span class="ot">=</span> sheet[<span class="fu">c</span>(<span class="st">"year"</span>, facility_cols, numeric_cols)]</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sheet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
   year FAC_NAME FAC_CITY FAC_ZIP FAC_OPERATED_THIS_YR FACILITY_LEVEL TEACH_HOSP
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;          &lt;chr&gt;     
1  2023 ALAMEDA… ALAMEDA  94501   Yes                  Parent Facili… No        
2  2023 ALTA BA… BERKELEY 94705   Yes                  Parent Facili… No        
3  2023 UCSF BE… OAKLAND  94609   Yes                  Parent Facili… No        
4  2023 FAIRMON… SAN LEA… 94578   Yes                  Consolidated … No        
5  2023 ALTA BA… BERKELEY 94704   Yes                  Consolidated … No        
6  2023 HIGHLAN… OAKLAND  94602   Yes                  Parent Facili… No        
# ℹ 15 more variables: COUNTY &lt;chr&gt;, PRIN_SERVICE_TYPE &lt;chr&gt;,
#   TOT_LIC_BEDS &lt;dbl&gt;, TOT_LIC_BED_DAYS &lt;dbl&gt;, TOT_DISCHARGES &lt;dbl&gt;,
#   TOT_CEN_DAYS &lt;dbl&gt;, TOT_ALOS_CY &lt;dbl&gt;, TOT_ALOS_PY &lt;dbl&gt;,
#   ACUTE_RESPIRATORY_CARE_LIC_BEDS &lt;dbl&gt;,
#   ACUTE_RESPIRATORY_CARE_LIC_BED_DAYS &lt;dbl&gt;,
#   ACUTE_RESPIRATORY_CARE_DISCHARGES &lt;dbl&gt;,
#   ACUTE_RESPIRATORY_CARE_INTRA_TRANSFERS &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Lowercase names are easier to type, so let’s also make all of the names lowercase with stringr’s <code>str_to_lower</code> function:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sheet) <span class="ot">=</span> <span class="fu">str_to_lower</span>(<span class="fu">names</span>(sheet))</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sheet)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
   year fac_name fac_city fac_zip fac_operated_this_yr facility_level teach_hosp
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;          &lt;chr&gt;     
1  2023 ALAMEDA… ALAMEDA  94501   Yes                  Parent Facili… No        
2  2023 ALTA BA… BERKELEY 94705   Yes                  Parent Facili… No        
3  2023 UCSF BE… OAKLAND  94609   Yes                  Parent Facili… No        
4  2023 FAIRMON… SAN LEA… 94578   Yes                  Consolidated … No        
5  2023 ALTA BA… BERKELEY 94704   Yes                  Consolidated … No        
6  2023 HIGHLAN… OAKLAND  94602   Yes                  Parent Facili… No        
# ℹ 15 more variables: county &lt;chr&gt;, prin_service_type &lt;chr&gt;,
#   tot_lic_beds &lt;dbl&gt;, tot_lic_bed_days &lt;dbl&gt;, tot_discharges &lt;dbl&gt;,
#   tot_cen_days &lt;dbl&gt;, tot_alos_cy &lt;dbl&gt;, tot_alos_py &lt;dbl&gt;,
#   acute_respiratory_care_lic_beds &lt;dbl&gt;,
#   acute_respiratory_care_lic_bed_days &lt;dbl&gt;,
#   acute_respiratory_care_discharges &lt;dbl&gt;,
#   acute_respiratory_care_intra_transfers &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>We’ve successfully read one of the files! Since the 2018-2023 files all have the same format, it’s likely that we can use almost the same code for all of them. Any time you want to reuse code, it’s a sign that you should write a function, so that’s what we’ll do. We’ll take all of the code we have so far and put it in the body of a function called <code>read_hospital_data</code>, adding some comments to indicate the steps:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>read_hospital_data <span class="ot">=</span> <span class="cf">function</span>() {</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the 2nd sheet of the file.</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  path <span class="ot">=</span> <span class="st">"data/ca_hospitals/hosp23_util_data_final.xlsx"</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the first 4 and last row.</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> sheet[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), ]</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">head</span>(sheet, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only a few columns of interest.</span></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>  facility_cols <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FAC_NAME"</span>, <span class="st">"FAC_CITY"</span>, <span class="st">"FAC_ZIP"</span>, <span class="st">"FAC_OPERATED_THIS_YR"</span>,</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FACILITY_LEVEL"</span>, <span class="st">"TEACH_HOSP"</span>, <span class="st">"COUNTY"</span>, <span class="st">"PRIN_SERVICE_TYPE"</span></span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">=</span> <span class="fu">names</span>(sheet)</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>  tot_cols <span class="ot">=</span> cols[<span class="fu">str_starts</span>(cols, <span class="st">"TOT"</span>)]</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>  respiratory_cols <span class="ot">=</span> cols[<span class="fu">str_detect</span>(cols, <span class="st">"RESPIRATORY"</span>)]</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a>  numeric_cols <span class="ot">=</span> <span class="fu">c</span>(tot_cols, respiratory_cols)</span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a>  sheet[numeric_cols] <span class="ot">=</span> <span class="fu">lapply</span>(sheet[numeric_cols], as.numeric)</span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>  sheet<span class="sc">$</span>year <span class="ot">=</span> <span class="dv">2023</span></span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> sheet[<span class="fu">c</span>(<span class="st">"year"</span>, facility_cols, numeric_cols)]</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the columns to lowercase.</span></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sheet) <span class="ot">=</span> <span class="fu">str_to_lower</span>(<span class="fu">names</span>(sheet))</span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>  sheet</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>As it is, the function still only reads the 2023 file. The other files have different paths, so the first thing we need to do is make the <code>path</code> variable a parameter. We’ll also make a <code>year</code> parameter, for the year value inserted as a column:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>read_hospital_data <span class="ot">=</span> <span class="cf">function</span>(path, year) {</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the 2nd sheet of the file.</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the first 4 and last row.</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> sheet[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), ]</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">head</span>(sheet, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only a few columns of interest.</span></span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  facility_cols <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FAC_NAME"</span>, <span class="st">"FAC_CITY"</span>, <span class="st">"FAC_ZIP"</span>, <span class="st">"FAC_OPERATED_THIS_YR"</span>,</span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FACILITY_LEVEL"</span>, <span class="st">"TEACH_HOSP"</span>, <span class="st">"COUNTY"</span>, <span class="st">"PRIN_SERVICE_TYPE"</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">=</span> <span class="fu">names</span>(sheet)</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>  tot_cols <span class="ot">=</span> cols[<span class="fu">str_starts</span>(cols, <span class="st">"TOT"</span>)]</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>  respiratory_cols <span class="ot">=</span> cols[<span class="fu">str_detect</span>(cols, <span class="st">"RESPIRATORY"</span>)]</span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>  numeric_cols <span class="ot">=</span> <span class="fu">c</span>(tot_cols, respiratory_cols)</span>
<span id="cb85-20"><a href="#cb85-20" aria-hidden="true" tabindex="-1"></a>  sheet[numeric_cols] <span class="ot">=</span> <span class="fu">lapply</span>(sheet[numeric_cols], as.numeric)</span>
<span id="cb85-21"><a href="#cb85-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-22"><a href="#cb85-22" aria-hidden="true" tabindex="-1"></a>  sheet<span class="sc">$</span>year <span class="ot">=</span> year</span>
<span id="cb85-23"><a href="#cb85-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-24"><a href="#cb85-24" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> sheet[<span class="fu">c</span>(<span class="st">"year"</span>, facility_cols, numeric_cols)]</span>
<span id="cb85-25"><a href="#cb85-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-26"><a href="#cb85-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the columns to lowercase.</span></span>
<span id="cb85-27"><a href="#cb85-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sheet) <span class="ot">=</span> <span class="fu">str_to_lower</span>(<span class="fu">names</span>(sheet))</span>
<span id="cb85-28"><a href="#cb85-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-29"><a href="#cb85-29" aria-hidden="true" tabindex="-1"></a>  sheet</span>
<span id="cb85-30"><a href="#cb85-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Test the function out on a few of the files to make sure it works correctly:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_hospital_data</span>(</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/ca_hospitals/hosp23_util_data_final.xlsx"</span>, <span class="dv">2023</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `` -&gt; `...355`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
   year fac_name fac_city fac_zip fac_operated_this_yr facility_level teach_hosp
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;          &lt;chr&gt;     
1  2023 ALAMEDA… ALAMEDA  94501   Yes                  Parent Facili… No        
2  2023 ALTA BA… BERKELEY 94705   Yes                  Parent Facili… No        
3  2023 UCSF BE… OAKLAND  94609   Yes                  Parent Facili… No        
4  2023 FAIRMON… SAN LEA… 94578   Yes                  Consolidated … No        
5  2023 ALTA BA… BERKELEY 94704   Yes                  Consolidated … No        
6  2023 HIGHLAN… OAKLAND  94602   Yes                  Parent Facili… No        
# ℹ 15 more variables: county &lt;chr&gt;, prin_service_type &lt;chr&gt;,
#   tot_lic_beds &lt;dbl&gt;, tot_lic_bed_days &lt;dbl&gt;, tot_discharges &lt;dbl&gt;,
#   tot_cen_days &lt;dbl&gt;, tot_alos_cy &lt;dbl&gt;, tot_alos_py &lt;dbl&gt;,
#   acute_respiratory_care_lic_beds &lt;dbl&gt;,
#   acute_respiratory_care_lic_bed_days &lt;dbl&gt;,
#   acute_respiratory_care_discharges &lt;dbl&gt;,
#   acute_respiratory_care_intra_transfers &lt;dbl&gt;, …</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_hospital_data</span>(</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"data/ca_hospitals/hosp21_util_data_final-revised-06.15.2023.xlsx"</span>, <span class="dv">2021</span></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 22
   year fac_name fac_city fac_zip fac_operated_this_yr facility_level teach_hosp
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;          &lt;chr&gt;     
1  2021 ALAMEDA… ALAMEDA  94501   Yes                  Parent Facili… No        
2  2021 ALTA BA… BERKELEY 94705   Yes                  Parent Facili… No        
3  2021 UCSF BE… OAKLAND  94609   Yes                  Parent Facili… No        
4  2021 FAIRMON… SAN LEA… 94578   Yes                  Consolidated … No        
5  2021 ALTA BA… BERKELEY 94704   Yes                  Consolidated … No        
6  2021 HIGHLAN… OAKLAND  94602   Yes                  Parent Facili… No        
# ℹ 15 more variables: county &lt;chr&gt;, prin_service_type &lt;chr&gt;,
#   tot_lic_beds &lt;dbl&gt;, tot_lic_bed_days &lt;dbl&gt;, tot_discharges &lt;dbl&gt;,
#   tot_cen_days &lt;dbl&gt;, tot_alos_cy &lt;dbl&gt;, tot_alos_py &lt;dbl&gt;,
#   acute_respiratory_care_lic_beds &lt;dbl&gt;,
#   acute_respiratory_care_lic_bed_days &lt;dbl&gt;,
#   acute_respiratory_care_discharges &lt;dbl&gt;,
#   acute_respiratory_care_intra_transfers &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>The function appears to work correctly for two of the files, so let’s work towards trying it on all of the 2018-2023 files. We can use the built-in <code>list.files</code> function to get the paths to the files by setting <code>full.names = TRUE</code> (otherwise it just returns the names of the files):</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>paths <span class="ot">=</span> <span class="fu">list.files</span>(<span class="st">"data/ca_hospitals/"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>paths</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/ca_hospitals//hosp16_util_data_final.xlsx"                   
[2] "data/ca_hospitals//hosp17_util_data_final.xlsx"                   
[3] "data/ca_hospitals//hosp18_util_data_final.xlsx"                   
[4] "data/ca_hospitals//hosp19_util_data_final.xlsx"                   
[5] "data/ca_hospitals//hosp20_util_data_final-revised-06.15.2023.xlsx"
[6] "data/ca_hospitals//hosp21_util_data_final-revised-06.15.2023.xlsx"
[7] "data/ca_hospitals//hosp22_util_data_final_revised_11.28.2023.xlsx"
[8] "data/ca_hospitals//hosp23_util_data_final.xlsx"                   </code></pre>
</div>
</div>
<p>In addition to the file paths, we also need the year for each file. Fortunately, the last two digits of the year are included in each file’s name. We can write a function to get these. We’ll use R’s built-in <code>basename</code> function to get the file names from the paths, and stringr’s <code>str_sub</code> function to get a substring (the year) from the name:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>get_hospital_year <span class="ot">=</span> <span class="cf">function</span>(path) {</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  name <span class="ot">=</span> <span class="fu">basename</span>(path)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">=</span> <span class="fu">str_sub</span>(name, <span class="dv">5</span>, <span class="dv">6</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.integer</span>(year) <span class="sc">+</span> <span class="dv">2000</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="fu">get_hospital_year</span>(paths[<span class="dv">1</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2016</code></pre>
</div>
</div>
<!--
Now we can use a for-loop to iterate over all of the files. We'll skip the
pre-2018 files for now:


::: {.cell}

```{.r .cell-code}
hosps = list()

for (i in seq_along(paths)) {
  path = paths[[i]]
  year = get_hospital_year(path)
  # Only years 2018-2023.
  if (year >= 2018) {
    hosp = read_hospital_data(path, year)
    hosps[[i]] = hosp
  }
}
```

::: {.cell-output .cell-output-stderr}

```
New names:
• `` -> `...355`
```


:::

```{.r .cell-code}
length(hosps)
```

::: {.cell-output .cell-output-stdout}

```
[1] 8
```


:::
:::

-->
<p>With that done, we need to read the pre-2018 files. In the 2018 file, the fourth sheet is a crosswalk that shows which columns in the pre-2018 files correspond to columns in the later files. Let’s write some code to read the crosswalk. First, read the sheet:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">=</span> <span class="st">"data/ca_hospitals/hosp18_util_data_final.xlsx"</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>cwalk <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="dv">4</span>)</span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cwalk)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 6
   Page  Line Column `SIERA Dataset Header (2018)` ALIRTS Dataset Header…¹ Notes
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;                         &lt;chr&gt;                   &lt;chr&gt;
1     1     1      1 FAC_NAME                      FAC_NAME                &lt;NA&gt; 
2     1     2      1 FAC_NO                        OSHPD_ID                &lt;NA&gt; 
3     1     3      1 FAC_STR_ADDR                  &lt;NA&gt;                    Addr…
4     1     4      1 FAC_CITY                      FAC_CITY                &lt;NA&gt; 
5     1     5      1 FAC_ZIP                       FAC_ZIPCODE             &lt;NA&gt; 
6     1     6      1 FAC_PHONE                     FAC_PHONE               &lt;NA&gt; 
# ℹ abbreviated name: ¹​`ALIRTS Dataset Header (2017)`</code></pre>
</div>
</div>
<p>The new and old column names are in the fourth and fifth columns, respectively, so we’ll get just those:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>cwalk <span class="ot">=</span> cwalk[, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cwalk)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 2
  `SIERA Dataset Header (2018)` `ALIRTS Dataset Header (2017)`
  &lt;chr&gt;                         &lt;chr&gt;                         
1 FAC_NAME                      FAC_NAME                      
2 FAC_NO                        OSHPD_ID                      
3 FAC_STR_ADDR                  &lt;NA&gt;                          
4 FAC_CITY                      FAC_CITY                      
5 FAC_ZIP                       FAC_ZIPCODE                   
6 FAC_PHONE                     FAC_PHONE                     </code></pre>
</div>
</div>
<p>Finally, let’s turn the <code>cwalk</code> data frame into a named vector. We’ll make the old column names the names and the new column names the elements. This way we can easily look up the new name for any of the old columns by indexing. Some of the column names in <code>cwalk</code> have extra spaces at the end, so we’ll use stringr’s <code>str_trim</code> function to remove them:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>cwalk_names <span class="ot">=</span> <span class="fu">str_trim</span>(cwalk[[<span class="dv">2</span>]])</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>cwalk <span class="ot">=</span> <span class="fu">str_trim</span>(cwalk[[<span class="dv">1</span>]])</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cwalk) <span class="ot">=</span> cwalk_names</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cwalk)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      FAC_NAME       OSHPD_ID           &lt;NA&gt;       FAC_CITY    FAC_ZIPCODE 
    "FAC_NAME"       "FAC_NO" "FAC_STR_ADDR"     "FAC_CITY"      "FAC_ZIP" 
     FAC_PHONE 
   "FAC_PHONE" </code></pre>
</div>
</div>
<p>We can now define a new version of the <code>read_hospital_data</code> function that uses the crosswalk to change the column names when <code>year &lt; 2018</code>. Let’s also change function to exclude columns with <code>ALOS</code> in the name, because they have no equivalent in the pre-2018 files:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>read_hospital_data <span class="ot">=</span> <span class="cf">function</span>(path, year) {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read the 2nd sheet of the file.</span></span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">read_excel</span>(path, <span class="at">sheet =</span> <span class="dv">2</span>)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove the first 4 and last row.</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> sheet[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>), ]</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> <span class="fu">head</span>(sheet, <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb101-8"><a href="#cb101-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-9"><a href="#cb101-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fix pre-2018 column names.</span></span>
<span id="cb101-10"><a href="#cb101-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (year <span class="sc">&lt;</span> <span class="dv">2018</span>) {</span>
<span id="cb101-11"><a href="#cb101-11" aria-hidden="true" tabindex="-1"></a>    new_names <span class="ot">=</span> cwalk[<span class="fu">names</span>(sheet)]</span>
<span id="cb101-12"><a href="#cb101-12" aria-hidden="true" tabindex="-1"></a>    new_names[<span class="fu">is.na</span>(new_names)] <span class="ot">=</span> <span class="fu">names</span>(sheet)[<span class="fu">is.na</span>(new_names)]</span>
<span id="cb101-13"><a href="#cb101-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(sheet) <span class="ot">=</span> new_names</span>
<span id="cb101-14"><a href="#cb101-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb101-15"><a href="#cb101-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-16"><a href="#cb101-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select only a few columns of interest.</span></span>
<span id="cb101-17"><a href="#cb101-17" aria-hidden="true" tabindex="-1"></a>  facility_cols <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb101-18"><a href="#cb101-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FAC_NAME"</span>, <span class="st">"FAC_CITY"</span>, <span class="st">"FAC_ZIP"</span>, <span class="st">"FAC_OPERATED_THIS_YR"</span>,</span>
<span id="cb101-19"><a href="#cb101-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"FACILITY_LEVEL"</span>, <span class="st">"TEACH_HOSP"</span>, <span class="st">"COUNTY"</span>, <span class="st">"PRIN_SERVICE_TYPE"</span></span>
<span id="cb101-20"><a href="#cb101-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb101-21"><a href="#cb101-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-22"><a href="#cb101-22" aria-hidden="true" tabindex="-1"></a>  cols <span class="ot">=</span> <span class="fu">names</span>(sheet)</span>
<span id="cb101-23"><a href="#cb101-23" aria-hidden="true" tabindex="-1"></a>  tot_cols <span class="ot">=</span> cols[<span class="fu">str_starts</span>(cols, <span class="st">"TOT"</span>)]</span>
<span id="cb101-24"><a href="#cb101-24" aria-hidden="true" tabindex="-1"></a>  respiratory_cols <span class="ot">=</span> cols[<span class="fu">str_detect</span>(cols, <span class="st">"RESPIRATORY"</span>)]</span>
<span id="cb101-25"><a href="#cb101-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-26"><a href="#cb101-26" aria-hidden="true" tabindex="-1"></a>  numeric_cols <span class="ot">=</span> <span class="fu">c</span>(tot_cols, respiratory_cols)</span>
<span id="cb101-27"><a href="#cb101-27" aria-hidden="true" tabindex="-1"></a>  numeric_cols <span class="ot">=</span> numeric_cols[<span class="sc">!</span><span class="fu">str_detect</span>(numeric_cols, <span class="st">"ALOS"</span>)]</span>
<span id="cb101-28"><a href="#cb101-28" aria-hidden="true" tabindex="-1"></a>  sheet[numeric_cols] <span class="ot">=</span> <span class="fu">lapply</span>(sheet[numeric_cols], as.numeric)</span>
<span id="cb101-29"><a href="#cb101-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-30"><a href="#cb101-30" aria-hidden="true" tabindex="-1"></a>  sheet<span class="sc">$</span>year <span class="ot">=</span> year</span>
<span id="cb101-31"><a href="#cb101-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-32"><a href="#cb101-32" aria-hidden="true" tabindex="-1"></a>  sheet <span class="ot">=</span> sheet[<span class="fu">c</span>(<span class="st">"year"</span>, facility_cols, numeric_cols)]</span>
<span id="cb101-33"><a href="#cb101-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-34"><a href="#cb101-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the columns to lowercase.</span></span>
<span id="cb101-35"><a href="#cb101-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(sheet) <span class="ot">=</span> <span class="fu">str_to_lower</span>(<span class="fu">names</span>(sheet))</span>
<span id="cb101-36"><a href="#cb101-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-37"><a href="#cb101-37" aria-hidden="true" tabindex="-1"></a>  sheet</span>
<span id="cb101-38"><a href="#cb101-38" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now we can test the function on all of the files. We’ll use a for-loop to iterate over all of the paths, read the data for each one, and store the result in a list:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>hosps <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(paths)) {</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  path <span class="ot">=</span> paths[[i]]</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>  year <span class="ot">=</span> <span class="fu">get_hospital_year</span>(path)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  hosp <span class="ot">=</span> <span class="fu">read_hospital_data</span>(path, year)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  hosps[[i]] <span class="ot">=</span> hosp</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
New names:
New names:
• `PSY_CENS_PATIENT_TOTL` -&gt; `PSY_CENS_PATIENT_TOTL...126`
• `PSY_CENS_PATIENT_TOTL` -&gt; `PSY_CENS_PATIENT_TOTL...130`
• `PSY_CENS_PATIENT_TOTL` -&gt; `PSY_CENS_PATIENT_TOTL...141`</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(hosps)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8</code></pre>
</div>
</div>
<p>We can use the <code>do.call</code> and <code>rbind</code> functions to bind the rows, or stack, the list of data frames:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>hosps <span class="ot">=</span> <span class="fu">do.call</span>(rbind, hosps)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(hosps)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 18
   year fac_name fac_city fac_zip fac_operated_this_yr facility_level teach_hosp
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt;                &lt;chr&gt;          &lt;chr&gt;     
1  2016 ALTA BA… BERKELEY 94705   Yes                  Parent Facili… NO        
2  2016 CHILDRE… OAKLAND  94609   Yes                  Parent Facili… NO        
3  2016 THUNDER… OAKLAND  94609   Yes                  Parent Facili… NO        
4  2016 FAIRMON… SAN LEA… 94578   Yes                  Consolidated … NO        
5  2016 ALTA BA… BERKELEY 94704   Yes                  Consolidated … NO        
6  2016 HIGHLAN… OAKLAND  94602   Yes                  Parent Facili… YES       
# ℹ 11 more variables: county &lt;chr&gt;, prin_service_type &lt;chr&gt;,
#   tot_lic_beds &lt;dbl&gt;, tot_lic_bed_days &lt;dbl&gt;, tot_discharges &lt;dbl&gt;,
#   tot_cen_days &lt;dbl&gt;, acute_respiratory_care_lic_beds &lt;dbl&gt;,
#   acute_respiratory_care_lic_bed_days &lt;dbl&gt;,
#   acute_respiratory_care_discharges &lt;dbl&gt;,
#   acute_respiratory_care_intra_transfers &lt;dbl&gt;,
#   acute_respiratory_care_cen_days &lt;dbl&gt;</code></pre>
</div>
</div>
<p>We’ve finally got all of the data in a single data frame!</p>
<p>To begin to address whether hospital utilization changed in 2020, let’s make a bar plot of total census-days:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>)</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(hosps) <span class="sc">+</span></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">weight =</span> tot_cen_days) <span class="sc">+</span></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>()</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="control-flow_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>According to the plot, total census-days was slightly lower in 2020 than in 2019. This is a bit surprising, but it’s possible that California hospitals typically operate close to maximum capacity and were not able to substantially increase the number of beds in 2020 in response to the COVID-19 pandemic. You can use other columns in the dataset, such as <code>tot_lic_beds</code> or <code>tot_lic_bed_days</code>, to check this.</p>
<p>Let’s also look at census-days for acute respiratory care:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(hosps) <span class="sc">+</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">weight =</span> acute_respiratory_care_cen_days) <span class="sc">+</span></span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>()</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="control-flow_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this plot, there’s a clear uptick in census-days in 2020, and then an interesting decrease to below 2019 levels in the years following. Again, you could use other columns in the dataset to investigate this further. We’ll end this case study here, having accomplished the difficult task of reading the data and the much easier task of doing a cursory preliminary analysis of the data.</p>
</section>
<section id="case-study-the-collatz-conjecture" class="level2" data-number="26.9">
<h2 data-number="26.9" class="anchored" data-anchor-id="case-study-the-collatz-conjecture"><span class="header-section-number">26.9</span> Case Study: The Collatz Conjecture</h2>
<p>The <a href="https://en.wikipedia.org/wiki/Collatz_conjecture">Collatz Conjecture</a> is a conjecture in math that was introduced in 1937 by Lothar Collatz and remains unproven today, despite being relatively easy to explain. Here’s a statement of the conjecture:</p>
<blockquote class="blockquote">
<p>Start from any positive integer. If the integer is even, divide by 2. If the integer is odd, multiply by 3 and add 1.</p>
<p>If the result is not 1, repeat using the result as the new starting value.</p>
<p>The result will always reach 1 eventually, regardless of the starting value.</p>
</blockquote>
<p>The sequences of numbers this process generates are called <strong>Collatz sequences</strong>. For instance, the Collatz sequence starting from 2 is <code>2, 1</code>. The Collatz sequence starting from 12 is <code>12, 6, 3, 10, 5, 16, 8, 4, 2, 1</code>.</p>
<p>You can use iteration to compute the Collatz sequence for a given starting value. Since each number in the sequence depends on the previous one, and since the length of the sequence varies, a while-loop is the most appropriate iteration strategy:</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>i <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (n <span class="sc">!=</span> <span class="dv">1</span>) {</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  i <span class="ot">=</span> i <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (n <span class="sc">%%</span> <span class="dv">2</span> <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">=</span> n <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    n <span class="ot">=</span> <span class="dv">3</span> <span class="sc">*</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">message</span>(n, <span class="st">" "</span>, <span class="at">appendLF =</span> <span class="cn">FALSE</span>)</span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>16 8 4 2 1</code></pre>
</div>
</div>
<p>As of 2020, scientists have used computers to check the Collatz sequences for every number up to approximately <span class="math inline">\(2^{64}\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled" title="See also">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>See also
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more details about the Collatz Conjecture, check out <a href="https://www.youtube.com/watch?v=094y1Z2wpJg">this video</a>.</p>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../chapters/week08/writing-functions.html" class="pagination-link" aria-label="Writing Functions">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Writing Functions</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/week09/web-scraping.html" class="pagination-link" aria-label="Web Scraping">
        <span class="nav-page-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Web Scraping</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucdavisdatalab/adventures_in_data_science/blob/main/chapters/week08/control-flow.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div></div></footer></body></html>